זוגי/אי-זוגי ליגת בית: תרגיל

Homework Exercise: Even/Odd League

סגל יורם ד”ר

© Dr. Segal Yoram - שמורות הזכויות כל

2025

2.0 גרסה



העניינים תוכן

12 MCP ופרוטוקול AI סוכני מבוא: 1

12 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ?AI סוכן מהו 1.1

12 . . . . . . . . . . . . . . . . . . . . . . . . . AI סוכן של מאפיינים 1.1.1

12 . . . . . . . . . . . . . . . . . . . Model Context Protocol – MCP פרוטוקול 1.2

12 . . . . . . . . . . . . . . . . . . . . . . . . . . הפרוטוקול עקרונות 1.2.1

1.2.2 Host/Server ארכיטקטורת . . . . . . . . . . . . . . . . . . . . . . . . 13

13 . . . . . . . . . . . . . . . . . . . . . . . . . . localhost על HTTP תחבורת 1.3

13 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . פורטים הגדרת 1.3.1

13 . . . . . . . . . . . . . . . . . . . . . . . . . . סוכן לכתובת דוגמה 1.3.2

14 . . . . . . . . . . . . . . . . . . . . . . . . . . . . JSON­RPC הודעת מבנה 1.4

14 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . התרגיל מטרת 1.5

14 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הלמידה יעד 1.5.1

16 הכללי הליגה פרוטוקול 2

16 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הפרוטוקול עקרונות 2.1

16 . . . . . . . . . . . . . . . . . . . . . . . . . שכבות לשלוש הפרדה 2.1.1

16 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הסוכנים סוגי 2.2

16 . . . . . . . . . . . . . . . . . . . . . League Manager – ליגה מנהל 2.2.1

16 . . . . . . . . . . . . . . . . . . . . . . . . . . . . Referee – שופט 2.2.2

17 . . . . . . . . . . . . . . . . . . . . . . Player Agent – שחקן סוכן 2.2.3

17 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . בפרוטוקול מזהים 2.3

17 . . . . . . . . . . . . . . . . . . . . . . . . . . . . למזהים דוגמאות 2.3.1

18 . . . . . . . . . . . . . . . . . . . . . . . . . Envelope – כללי הודעה מבנה 2.4

18 . . . . . . . . . . . . . . . . . . . . . . . . . במעטפת חובה שדות 2.4.1

19 . . . . . . . . . . . . . . . . . . . . UTC/GMT – זמן אזור דרישת 2.4.2

19 . . . . . . . . . . . . . . . . . . . . . . . . . . . אופציונליים שדות 2.4.3

19 . . . . . . . . . . . . . . . . . . . . . . . . . . sender שדה פורמט 2.4.4

20 . . . . . . . . . . . . . . . . . . . . . . . auth_token – אימות טוקן 2.4.5

20 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הכללית הליגה זרימת 2.5

20 . . . . . . . . . . . . . . . . . . . . . . . . . שופטים רישום :1 שלב 2.5.1

20 . . . . . . . . . . . . . . . . . . . . . . . . שחקנים רישום :2 שלב 2.5.2

20 . . . . . . . . . . . . . . . . . . . . . . משחקים לוח יצירת :3 שלב 2.5.3

20 . . . . . . . . . . . . . . . . . . . . . . . מחזור על הכרזה :4 שלב 2.5.4

© Dr. Segal Yoram - שמורות הזכויות כל 2



21 . . . . . . . . . . . . . . . . . . . . . . . . משחקים ניהול :5 שלב 2.5.5

21 . . . . . . . . . . . . . . . . . . . . . . . . . . דירוג עדכון :6 שלב 2.5.6

21 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . כללית זרימה דיאגרמת 2.6

21 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Timeouts – תגובה זמני 2.7

22 . . . . . . . . . . . . . . . . . . . . Agent Lifecycle – סוכן של חיים מחזור 2.8

22 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הסוכן מצבי 2.8.1

22 . . . . . . . . . . . . . . . . . . . . . . . . מצבים מעברי דיאגרמת 2.8.2

23 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . בשגיאות טיפול 2.9

23 . . . . . . . . . . . . . . . . . . LEAGUE_ERROR – ליגה שגיאת 2.9.1

23 . . . . . . . . . . . . . . . . . . . GAME_ERROR – משחק שגיאת 2.9.2

24 . . . . . . . . . . . . . . . . . . . . . . . . . . נפוצים שגיאה קודי 2.9.3

24 . . . . . . . . . . . . . . . . . . Retry Policy – חוזר ניסיון מדיניות 2.9.4

24 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . גרסאות תאימות 2.10

25 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . גרסה הכרזת 2.10.1

25 . . . . . . . . . . . . . . . . . . . . . . . . . . . תאימות מדיניות 2.10.2

25 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . חשובים עקרונות 2.11

25 . . . . . . . . . . . . . . . . . . . . . . . . . . . יחיד אמת מקור 2.11.1

25 . . . . . . . . . . . . . . . . . . . . . . Orchestrator דרך תקשורת 2.11.2

25 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . בכשלים טיפול 2.11.3

26 זוגי/אי-זוגי משחק 3

26 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . המשחק תיאור 3.1

26 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . המשחק חוקי 3.1.1

26 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . למשחק דוגמה 3.1.2

26 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . בודד משחק זרימת 3.2

26 . . . . . . . . . . . . . . . . . . . . . . . . למשחק הזמנה :1 שלב 3.2.1

27 . . . . . . . . . . . . . . . . . . . . . . . . . . הגעה אישור :2 שלב 3.2.2

27 . . . . . . . . . . . . . . . . . . . . . . . . . בחירות איסוף :3 שלב 3.2.3

27 . . . . . . . . . . . . . . . . . . . . . . . . . מספר הגרלת :4 שלב 3.2.4

27 . . . . . . . . . . . . . . . . . . . . . . . . . מנצח קביעת :5 שלב 3.2.5

27 . . . . . . . . . . . . . . . . . . . . . . . . . תוצאה דיווח :6 שלב 3.2.6

27 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . המשחק מצבי 3.3

27 . . . . . . . . . . . . . . . . . . . WAITING_FOR_PLAYERS מצב 3.3.1

28 . . . . . . . . . . . . . . . . . . . . COLLECTING_CHOICES מצב 3.3.2

28 . . . . . . . . . . . . . . . . . . . . . . DRAWING_NUMBER מצב 3.3.3

3 © Dr. Segal Yoram - שמורות הזכויות כל



28 . . . . . . . . . . . . . . . . . . . . . . . . . . . . FINISHED מצב 3.3.4

28 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הניקוד שיטת 3.4

28 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . למשחק ניקוד 3.4.1

28 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . בליגה דירוג 3.4.2

28 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Round­Robin ליגת 3.5

28 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . משחקים מספר 3.5.1

29 . . . . . . . . . . . . . . . . . . . . . . . . . לדוגמה משחקים לוח 3.5.2

29 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . לשחקנים אסטרטגיות 3.6

29 . . . . . . . . . . . . . . . . . . . . . . . . . . אקראית אסטרטגיה 3.6.1

29 . . . . . . . . . . . . . . . . . . . . היסטוריה מבוססת אסטרטגיה 3.6.2

29 . . . . . . . . . . . . . . . . . . . . . . . LLM מונחית אסטרטגיה 3.6.3

30 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . המשחק חוקי מודול 3.7

30 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . המודול ממשק 3.7.1

30 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ההפרדה יתרון 3.7.2

30 . . . . . . . . . . . . . . . . . . . . . . . . . . . נוספים למשחקים הרחבה 3.8

30 . . . . . . . . . . . . . . . . . . . GAME_MOVE – מהלך הפשטת 3.8.1

31 . . . . . . . . . . . . . . . . . . . . . . . גנרית מהלך הודעת מבנה 3.8.2

32 . . . . . . . . . . . . . . . . Game Registry – משחקים סוגי רישום 3.8.3

32 . . . . . . . . . . . . . . . . . . . . . . . . . . . ההפשטה יתרונות 3.8.4

33 JSON הודעות מבני 4

33 . . . . . . . . . . . . . . . . . . . . . . . . . . . לליגה שופט רישום הודעות 4.1

33 . . . . . REFEREE_REGISTER_REQUEST – שופט רישום בקשת 4.1.1

34 . . . . . REFEREE_REGISTER_RESPONSE – שופט רישום תגובת 4.1.2

35 . . . . . . . . . . . . . . . . . . . . . . . . . . . לליגה שחקן רישום הודעות 4.2

35 . . . . . . LEAGUE_REGISTER_REQUEST – שחקן רישום בקשת 4.2.1

36 . . . . . . . . LEAGUE_REGISTER_RESPONSE – רישום תגובת 4.2.2

37 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . מחזור הודעות 4.3

37 . . . . . . . . . . . ROUND_ANNOUNCEMENT – מחזור הכרזת 4.3.1

37 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . משחק הודעות 4.4

38 . . . . . . . . . . . . . . . GAME_INVITATION – למשחק הזמנה 4.4.1

38 . . . . . . . . . . . . . . . . . . GAME_JOIN_ACK – הגעה אישור 4.4.2

38 . . . . . . . . . . . . . . . . . . . . . . זוגי/אי-זוגי במשחק בחירה הודעות 4.5

39 . . . . . . . . . . . . . CHOOSE_PARITY_CALL – בחירה בקשת 4.5.1

39 . . . . . . . . . . CHOOSE_PARITY_RESPONSE – בחירה תגובת 4.5.2

© Dr. Segal Yoram - שמורות הזכויות כל 4



40 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . תוצאה הודעות 4.6

40 . . . . . . . . . . . . . . . . . . . . . GAME_OVER – משחק סיום 4.6.1

41 . . . . . . . . . MATCH_RESULT_REPORT – לליגה תוצאה דיווח 4.6.2

41 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . דירוג הודעות 4.7

42 . . . . . . . . . . LEAGUE_STANDINGS_UPDATE – דירוג עדכון 4.7.1

42 . . . . . . . . . . . . . . . . . . . . . . . . . . . וליגה מחזור סיום הודעות 4.8

43 . . . . . . . . . . . . . . . . ROUND_COMPLETED – מחזור סיום 4.8.1

44 . . . . . . . . . . . . . . . . LEAGUE_COMPLETED – ליגה סיום 4.8.2

44 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . שאילתא הודעות 4.9

45 . . . . . . . . . . . . . . . . . LEAGUE_QUERY – ליגה שאילתת 4.9.1

46 . . . . . . . . . LEAGUE_QUERY_RESPONSE – שאילתה תגובת 4.9.2

46 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . שגיאה הודעות 4.10

47 . . . . . . . . . . . . . הליגה ברמת שגיאה – LEAGUE_ERROR 4.10.1

48 . . . . . . . . . . . . . . המשחק ברמת שגיאה – GAME_ERROR 4.10.2

48 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הודעות סיכום טבלת 4.11

48 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . חשובים כללים 4.12

50 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . חובה שדות 4.12.1

50 . . . . . . . . . . . . . . . . . . . . . . . . . . . . מותרים ערכים 4.12.2

50 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . זמן פורמט 4.12.3

51 מימוש מדריך 5

51 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . כללית ארכיטקטורה 5.1

51 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . רכיבים תרשים 5.1.1

51 . . . . . . . . . . . . . . . . . . . . . . . . . Orchestrator-ה תפקיד 5.1.2

52 . . . . . . . . . . . . . . . . . . . . . . . . . . . . פשוט MCP שרת מימוש 5.2

52 . . . . . . . . . . . . . . . . . . . . . . . . FastAPI-ב בסיסי מבנה 5.2.1

52 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . שחקן סוכן מימוש 5.3

52 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . נדרשים כלים 5.3.1

53 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . לדוגמה מימוש 5.3.2

54 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . שופט מימוש 5.4

54 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . נדרשים כלים 5.4.1

54 . . . . . . . . . . . . . . . . . . . . . . . . . . . לליגה שופט רישום 5.4.2

55 . . . . . . . . . . . . . . . . . . . . . . . . . . מנצח קביעת לוגיקת 5.4.3

55 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ליגה מנהל מימוש 5.5

55 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . נדרשים כלים 5.5.1

5 © Dr. Segal Yoram - שמורות הזכויות כל



56 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . שופט רישום 5.5.2

57 . . . . . . . . . . . . . . . . . . . . . . . . . . משחקים לוח יצירת 5.5.3

58 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . HTTP בקשות שליחת 5.6

58 . . . . . . . . . . . . . . . . . . . . . . . . . . . MCP לכלי קריאה 5.6.1

59 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . מצב ניהול 5.7

59 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . שחקן מצב 5.7.1

60 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . בשגיאות טיפול 5.8

60 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . תגובה זמן 5.8.1

60 . . . . . . . . . . . . . . . . . . . . . . . . . . . . לשגיאות תגובה 5.8.2

60 . . . . . . . . . . . . . . . . . . . . . . . . (Resilience Patterns) חוסן דפוסי 5.9

61 . . . . . . . . . . . . . . . . . . . . . . . Backoff עם Retry מימוש 5.9.1

62 . . . . . . . . . . . . . . . . . . . . . . . . . . Circuit Breaker דפוס 5.9.2

62 . . . . . . . . . . . . . . . . . . . . . . (Structured Logging) מובנה תיעוד 5.10

63 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Logger מימוש 5.10.1

64 . . . . . . . . . . . . . . . . . . . . . . . . . . . . לשימוש דוגמה 5.10.2

64 . . . . . . . . . . . . . . . . . . . . . . . . (Authentication) וטוקנים אימות 5.11

65 . . . . . . . . . . . . . . . . . . . . . . . רישום בעת טוקן קבלת 5.11.1

66 . . . . . . . . . . . . . . . . . . . . . . . . בבקשות בטוקן שימוש 5.11.2

67 . . . . . . . . . . . . . . . . . . . . . . . . אימות בשגיאות טיפול 5.11.3

67 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . מקומיות בדיקות 5.12

67 . . . . . . . . . . . . . . . . . . . . . . . . . . . . מקומית הרצה 5.12.1

68 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . חיבור בדיקת 5.12.2

68 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . למימוש טיפים 5.13

69 הבית תרגיל דרישות 6

69 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . התרגיל מטרת 6.1

69 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . חובה משימות 6.2

69 . . . . . . . . . . . . . . . . . . . . . שחקן סוכן מימוש :1 משימה 6.2.1

69 . . . . . . . . . . . . . . . . . . . . . . . . לליגה רישום :2 משימה 6.2.2

69 . . . . . . . . . . . . . . . . . . . . . . . עצמית בדיקה :3 משימה 6.2.3

70 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . טכניות דרישות 6.3

70 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . תכנות שפת 6.3.1

70 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . תגובה זמני 6.3.2

70 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . יציבות 6.3.3

70 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . העבודה תהליך 6.4

© Dr. Segal Yoram - שמורות הזכויות כל 6



70 . . . . . . . . . . . . . . . . . . . . . . . . . מקומי פיתוח :1 שלב 6.4.1

70 . . . . . . . . . . . . . . . . . . . . . . . . . . פרטית ליגה :2 שלב 6.4.2

71 . . . . . . . . . . . אחרים סטודנטים עם תאימות בדיקת :3 שלב 6.4.3

71 . . . . . . . . . . . . . . . . . . . . . . . . כיתה ליגת לעתיד: מבט 6.4.4

71 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הגשה 6.5

71 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . להגשה קבצים 6.5.1

71 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הגשה פורמט 6.5.2

71 . . . . . . . . . . . . . . . . . . . . . . . . העבודה לבדיקת כלליים דגשים 6.6

72 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . נפוצות שאלות 6.7

72 . . . . . . . . . . . . . . חיצוניות? בספריות להשתמש אפשר האם 6.7.1

72 . . . . . . . . . . . . . . . . . . . ?Python-ב להשתמש חייבים האם 6.7.2

72 . . . . . . . . . . . . . . . . . . . קורס? שלי הסוכן אם קורה מה 6.7.3

72 . . . . . . . . . . . . ההגשה? אחרי הסוכן את לעדכן אפשר האם 6.7.4

72 . . . . . . . . . . . . . . . . . . . . . . . שלי? הדירוג מה אדע איך 6.7.5

73 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . סיכום 6.8

74 הליגה תרגיל דרך MCP למידת 7

74 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . AI כסוכן השחקן 7.1

74 . . . . . . . . . . . . . . . . . . . ?AI סוכן הוא השחקן סוכן האם 7.1.1

74 . . . . . . . . . . . . . . . . . . . . AI סוכן של המאפיינים ארבעת 7.1.2

74 . . . . . . . . . . . . . . . . . . . . . . . . . . MCP בארכיטקטורת השחקן 7.2

75 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . לקוח? או שרת 7.2.1

75 . . . . . . . . . . . . . . . . . . . הליגה ומנהל השופט מול היחסים 7.2.2

75 . . . . . . . . . . . . . . . . . . . . . . . . AI כסוכני הליגה ומנהל השופט 7.3

75 . . . . . . . . . . . . . . . . . . . . . . . . . גבוהה בדרגה סוכנים 7.3.1

75 . . . . . . . . . . . . . . . . . . כלקוחות גם שפועלים MCP שרתי 7.3.2

76 . . . . . . . . . . . . . . . . . . . . . . . מרכזית תובנה התפקידים: היפוך 7.4

76 . . . . . . . . . . . . . . . . . . . . . . . . . המסורתית הפרדיגמה 7.4.1

76 . . . . . . . . . . . . . . . . . . . . . . . . בליגה התפקידים היפוך 7.4.2

77 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . השכבות הפרדת עקרון 7.5

77 . . . . . . . . . . . . . . . . . . . . . . . . . נפרדות שכבות שלוש 7.5.1

77 . . . . . . . . . . . . . . . . . . . . . . . . . . ההפרדה של היתרון 7.5.2

78 . . . . . . . . . . . . . . . . . . . . . . . . . . השרת בסוכן LLM-ה תפקיד 7.6

78 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הדילמה 7.6.1

78 . . . . . . . . . . . . . . . . . . . . . . . תפקידים הפרדת הפתרון: 7.6.2

7 © Dr. Segal Yoram - שמורות הזכויות כל



78 . . . . . . . . . . . . . . . . . . . . לקוחות שירות תחנת אנלוגיה: 7.6.3

78 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . האורקסטרטור תפקיד 7.7

79 . . . . . . . . . . . . . . . . . . . . . . הארכיטקט – הליגה מנהל 7.7.1

79 . . . . . . . . . . . . . . . . . . . . . . . הדינמי המיישם – השופט 7.7.2

79 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . מלמד התרגיל מה 7.8

79 . . . . . . . . . . . . . . . . . . . . . . AI סוכני של יסוד עקרונות 7.8.1

79 . . . . . . . . . . . . . . . . . . . . . . . . MCP של יסוד עקרונות 7.8.2

80 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הלמידה חוויית 7.8.3

80 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . סיכום 7.9

81 הליגה מערכת הרצת 8

81 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . המערכת תצורת 8.1

81 . . . . . . . . . . . . . . . . . . . . . . . . . . . וטרמינלים פורטים 8.1.1

81 . . . . . . . . . . . . . . . . . . . . . . . האורקסטרטורים תפקידי 8.1.2

82 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הפעלה סדר 8.2

82 . . . . . . . . . . . . . . . . . . . . . . . . . . ההפעלה סדר עקרון 8.2.1

82 . . . . . . . . . . . . . . . . . . . . . . . הליגה מנהל – 1 טרמינל 8.2.2

82 . . . . . . . . . . . . . . . . . . . . . . . שופטים – 2­3 טרמינלים 8.2.3

83 . . . . . . . . . . . . . . . . . . . . . . . שחקנים – 4­7 טרמינלים 8.2.4

83 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . שופטים רישום :1 שלב 8.3

83 . . . . . . . . . . . . . . . . . . . . . . . . . . שופט רישום בקשת 8.3.1

84 . . . . . . . . . . . . . . . . . . . . . . . . . . הליגה מנהל תגובת 8.3.2

85 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . שחקנים רישום :2 שלב 8.4

85 . . . . . . . . . . . . . . . . . . . . . . . . . . שחקן רישום בקשת 8.4.1

86 . . . . . . . . . . . . . . . . . . . . . . . . . . הליגה מנהל תגובת 8.4.2

86 . . . . . . . . . . . . . . . . . . . . . . . . . . משחקים לוח יצירת :3 שלב 8.5

86 . . . . . . . . . . . . . . . . . . . . שחקנים לארבעה משחקים לוח 8.5.1

87 . . . . . . . . . . . . . . . . . . . . . . . . . . . . מחזור על הכרזה :4 שלב 8.6

88 . . . . . . . . . . . . . . . . . . . . . . . . . . . בודד משחק ניהול :5 שלב 8.7

89 . . . . . . . . . . . . . . . . . . . . . . . למשחק הזמנה :5.1 שלב 8.7.1

90 . . . . . . . . . . . . . . . . . . . . . . . . הגעה אישורי :5.2 שלב 8.7.2

92 . . . . . . . . . . . . . . . . . . . . . . . . בחירות איסוף :5.3 שלב 8.7.3

93 . . . . . . . . . . . . . . . . מנצח וקביעת מספר הגרלת :5.4 שלב 8.7.4

94 . . . . . . . . . . . . . . . . . . . לשחקנים סיום הודעת :5.5 שלב 8.7.5

95 . . . . . . . . . . . . . . . . . . . . . הליגה למנהל דיווח :5.6 שלב 8.7.6

© Dr. Segal Yoram - שמורות הזכויות כל 8



96 . . . . . . . . . . . . . . . . . . . . . . . דירוג ועדכון מחזור סיום :6 שלב 8.8

99 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הליגה סיום :7 שלב 8.9

99 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . בשגיאות טיפול 8.10

100 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . אימות שגיאת 8.10.1

101 . . . . . . . . . . . . . . . . . . . . . תגובה זמן – משחק שגיאת 8.10.2

101 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . זמינים שאילתות כלי 8.11

102 . . . . . . . . . . . . . . . . . . . . הליגה ממנהל דירוג שאילתת 8.11.1

102 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . נוספים כלים 8.11.2

8.12 מלאה זרימה דיאגרמת . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 103

104 . . . . . . . . . . . . . . . . . . . . . . . . . . . . הסוכנים תפקידי טבלת 8.13

104 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . סיכום 8.14

105 הליגה נתוני פרוטוקול 9

105 . . . . . . . . . . . . . . . . . . . . הסוכנים חברת של הגנטי הקוד מבוא: 9.1

105 . . . . . . . . . . . . . . . . . . . . . . . . . . השכבות שלוש ארכיטקטורת 9.2

105 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . מנחים עקרונות 9.2.1

105 . . . . . . . . . . . . . . . . . . . . . . . . . config/ – הקונפיגורציה שכבת 9.3

106 . . . . . . . . . . . . . . config/system.json – גלובלי מערכת קובץ 9.3.1

106 . . . . . . . . . . config/agents/agents_config.json – סוכנים רישום 9.3.2

107 . . . . . . . . config/leagues/<league_id>.json – ליגה קונפיגורציית 9.3.3

107 . . . . . . config/games/games_registry.json – משחקים סוגי רישום 9.3.4

107 . . . . . . . . . . . . . . config/defaults/ – לסוכנים מחדל ברירות 9.3.5

108 . . . . . . . . . . . . . . . . . . . . . . . . . . . data/ – הריצה נתוני שכבת 9.4

108 . . . . . . . data/leagues/<league_id>/standings.json – דירוג טבלת 9.4.1

108 . . . . data/leagues/<league_id>/rounds.json – מחזורים היסטוריית 9.4.2

108 . . data/matches/<league_id>/<match_id>.json – בודד משחק נתוני 9.4.3

109 . . . . . . data/players/<player_id>/history.json – שחקן היסטוריית 9.4.4

109 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . logs/ – הלוגים שכבת 9.5

110 . . . . . logs/league/<league_id>/league.log.jsonl – מרכזי ליגה לוג 9.5.1

110 . . . . . . . . . . . . . logs/agents/<agent_id>.log.jsonl – סוכן לוג 9.5.2

110 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . קבצים סיכום טבלת 9.6

110 . . . . . . . . . . . . . . . . . . . . . . . . . . . המשותפים בקבצים שימוש 9.7

112 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . סיכום 9.8

113 בפייתון כלים ערכת 10

9 © Dr. Segal Yoram - שמורות הזכויות כל



113 . . . . . . . . . . . . . . . . . . . . . . . . . . לקוד מהקונפיגורציה מבוא: 10.1

113 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הספרייה מבנה 10.2

113 . . . . . . . . . . . . . . . . . . . . config_models.py – טיפוסיים מודלים 10.3

113 . . . . . . . . . . . . . . . . . . . . . . . . . . Dataclasses הגישה: 10.3.1

114 . . . . . . . . . . . . . . . . . . . . . מערכת קונפיגורציית מודלי 10.3.2

115 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . סוכנים מודלי 10.3.3

116 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ליגה מודלי 10.3.4

117 . . . . . . . . . . . . . . . . . . . . . . ConfigLoader – קונפיגורציה טוען 10.4

117 . . . . . . . . . . . . . . . . . . מטמון עם עצלה טעינה העיקרון: 10.4.1

117 . . . . . . . . . . . . . . . . . . . . . . . . . . . . הטעינה שיטות 10.4.2

118 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . עזר שיטות 10.4.3

118 . . . . . . . . . . . . . . . . . . . . . . . . . Repositories – נתונים מאגרי 10.5

118 . . . . . . . . . . . . . . . . . . (Repository Pattern) המאגר דפוס 10.5.1

119 . . . . . . . . . . . . . StandingsRepository – דירוג טבלת מאגר 10.5.2

119 . . . . . . . . . . . . . . . . . . . . . . . . . . . . נוספים מאגרים 10.5.3

120 . . . . . . . . . . . . . . . . . . . . . . . . . . JsonLogger – לוגים רישום 10.6

120 . . . . . . . . . . . . . . . . . . . . . . . . . . JSON Lines פורמט 10.6.1

120 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הלוגר מחלקת 10.6.2

121 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . נוחות שיטות 10.6.3

122 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . בסוכנים שימוש 10.7

122 . . . . . . . . . . . . . . . . . . . . . . . . . . ליגה מנהל דוגמה: 10.7.1

123 . . . . . . . . . . . . . . . . . . . . . . . . . . שופט סוכן דוגמה: 10.7.2

124 . . . . . . . . . . . . . . . . . . . . . . . . . שגיאה רישום דוגמה: 10.7.3

124 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . סיכום 10.8

125 הפרויקט מבנה 11

125 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הדרכים מפת מבוא: 11.1

125 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . הראשי התיקיות עץ 11.2

125 . . . . . . . . . . . . . . . . . SHARED/ – המשותפים המשאבים תיקיית 11.3

127 . . . . . . . . . . . . . . . . . . . . . . . . . . . agents/ – הסוכנים תיקיית 11.4

127 . . . . . . . . . . . . . . . . . . . . . . . . . . טיפוסי סוכן מבנה 11.4.1

127 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . doc/ – התיעוד תיקיית 11.5

11.6 ארכיטקטורה דיאגרמת . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 129

129 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . נתונים זרימת 11.7

129 . . . . . . . . . . . . . . . . . . . . . . . . . . . . וכתיבה קריאה 11.7.1

© Dr. Segal Yoram - שמורות הזכויות כל 10



130 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . והפעלה התקנה 11.8

130 . . . . . . . . . . . . . . . . . . . . . . . . . . . מקדימות דרישות 11.8.1

130 . . . . . . . . . . . . . . . . . . . . . . . . . . . . תלויות התקנת 11.8.2

130 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . סוכן הפעלת 11.8.3

130 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . מלאה קבצים רשימת 11.9

131 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . סיכום 11.10

133 מקורות 12

11 © Dr. Segal Yoram - שמורות הזכויות כל



MCP ופרוטוקול AI סוכני מבוא: 1

?AI סוכן מהו 1.1

המידע. את מעבד הוא מהסביבה. מידע מקבל הסוכן אוטונומית. תוכנה הוא AI סוכן

פעולות. מבצע הוא מכן לאחר

AI סוכן מראש. קבועות הוראות מבצעת רגילה תוכנית רגילה. מתוכנית שונה AI סוכן

הנוכחי. המצב על מבוססת ההחלטה לעשות. מה בעצמו מחליט

AI סוכן של מאפיינים 1.1.1

מאפיינים: מספר יש AI סוכן לכל

עצמאי. באופן פועל הסוכן – אוטונומיות -

מהסביבה. מידע קולט הסוכן – תפיסה -

הסביבה. על משפיע הסוכן – פעולה -

מוגדרת. מטרה יש לסוכן – תכליתיות -

מתקשרים. סוכנים כיצד מוסבר ,[1] ”MCP עם AI “סוכני סגל יורם ד”ר של בספרו

בתרגיל. אלה בעקרונות נשתמש אנו בהרחבה. MCP פרוטוקול את מציג הספר

Model Context Protocol – MCP פרוטוקול 1.2

מאפשר הוא .Anthropic חברת ידי על פותח הפרוטוקול תקשורת. פרוטוקול הוא MCP

זה. עם זה לתקשר AI לסוכני

הפרוטוקול עקרונות 1.2.1

עקרונות: מספר על מבוסס הפרוטוקול

.JSON אובייקט היא הודעה כל – מובנות הודעות .1

זה. בתקן משתמש הפרוטוקול – JSON­RPC 2.0 תקן .2

כ“כלים”. פונקציות חושפים סוכנים – )slooT( כלים .3

.stdio או HTTP-ב להשתמש אפשר – גמישה תחבורה .4

© Dr. Segal Yoram - שמורות הזכויות כל 21



Host/Server ארכיטקטורת 1.2.2

רכיבים: סוגי שני יש MCP במערכת

כלי כל להם. לקרוא שאפשר “כלים” חושף השרת שירותים. שמספק רכיב – MCP שרת

מוגדרים. פרמטרים עם פונקציה הוא

מקבל הוא לשרתים. בקשות שולח המארח שרתים. בין שמתאם רכיב – (Host) מארח

אותן. ומעבד תשובות

Host

(Orchestrator)

JSON­RPC JSON­RPC JSON­RPC

MCP Server 1 MCP Server 2 MCP Server 3

localhost על HTTP תחבורת 1.3

.localhost-ב שונה פורט על יפעל סוכן כל .HTTP בתחבורת נשתמש זה בתרגיל

פורטים הגדרת 1.3.1

סוכן: לכל קבועים פורטים נגדיר

8000 פורט – League Manager -

8001 פורט – Referee -

8104 עד 8101 פורטים – שחקנים -

תוכן ./mcp בנתיב POST בקשות מקבל השרת פשוט. HTTP שרת מממש סוכן כל

.JSON­RPC 2.0 הוא הבקשה

סוכן לכתובת דוגמה 1.3.2

:League Manager שרת כתובת

http://localhost:8000/mcp

ראשון: שחקן שרת כתובת

http://localhost:8101/mcp

13 © Dr. Segal Yoram - שמורות הזכויות כל



JSON­RPC הודעת מבנה 1.4

קבוע. מבנה יש להודעה .JSON אובייקט היא בפרוטוקול הודעה כל

הודעה של בסיסי מבנה

{

"jsonrpc": "2.0",

"method": "tool_name",

"params": {

"param1": "value1",

"param2": "value2"

},

"id": 1

}

בהודעה: השדות

.”0.2“ תמיד הפרוטוקול, גרסת – jsonrpc -

להפעיל. שרוצים הכלי שם – method -

לכלי. פרמטרים – params -

לבקשה. ייחודי מזהה – id -

התרגיל מטרת 1.5

סוכנים: סוגי שלושה תכלול המערכת .AI לסוכני ליגה מערכת נבנה זה בתרגיל

ושופטים. שחקנים רישום כולל הליגה, את מנהל – (League Manager) ליגה מנהל .1

בודדים. משחקים ומנהל הליגה למנהל נרשם – (Referee) שופט .2

במשחקים. משתתפים – (Player Agents) שחקן סוכני .3

מנהל אצל להירשם חייבים שחקנים וגם שופטים גם הליגה, תחילת לפני הרישום: תהליך

למשחקים. אותם ומקצה זמינים שופטים של רשימה שומר הליגה מנהל הליגה.

משחק להחליף מאפשר הכללי הפרוטוקול “זוגי/אי-זוגי”. הוא בתרגיל הספציפי המשחק

אחרים. משחקים או שאלות, 12 באיקס-עיגול, להשתמש יהיה אפשר בעתיד.

הלמידה יעד 1.5.1

תוכלו: התרגיל בסיום

.MCP פרוטוקול את להבין -

פשוט. MCP שרת לבנות -

שונים. סוכנים בין לתקשר -

שלכם. בסביבה מלאה ליגה להריץ -

© Dr. Segal Yoram - שמורות הזכויות כל 14



אחרים. סטודנטים עם פרוטוקול תאימות לוודא -

זה לשחק שלכם לסוכנים יאפשר זה פרוטוקול. באותו ישתמשו הסטודנטים כל חשוב:

בעתיד. זה נגד

15 © Dr. Segal Yoram - שמורות הזכויות כל



הכללי הליגה פרוטוקול 2

הפרוטוקול עקרונות 2.1

סטודנט כל לתקשר. שונים לסוכנים מאפשרים הכללים אחידים. כללים מגדיר הפרוטוקול

בליגה. ישתתף הוא – הפרוטוקול את מכבד הסוכן עוד כל שירצה. בשפה סוכן לממש יכול

שכבות לשלוש הפרדה 2.1.1

שכבות: משלוש מורכבת המערכת

דירוג. טבלת שחקנים, רישום טורניר, ניהול – הליגה שכבת .1

מנצח. הכרזת מהלכים, אימות בודד, משחק ניהול – השיפוט שכבת .2

וכד’). איקס-עיגול, (זוגי/אי-זוגי, ספציפית משחק לוגיקת – המשחק חוקי שכבת .3

נשאר הכללי הפרוטוקול המשחק. שכבת את להחליף מאפשרת היא חשובה. ההפרדה

קבוע.

הסוכנים סוגי 2.2

League Manager – ליגה מנהל 2.2.1

על: אחראי הוא יחיד. סוכן הוא הליגה מנהל

לליגה. שחקנים רישום -

.(Round­Robin) משחקים לוח יצירת -

מהשופטים. תוצאות קבלת -

דירוג. טבלת ופרסום חישוב -

.8000 פורט על MCP כשרת פועל הליגה מנהל

Referee – שופט 2.2.2

להירשם חייב הוא משחקים, לשפוט יכול שהשופט לפני חשוב: בודד. משחק מנהל השופט

הליגה. מנהל אצל

על: אחראי השופט

הליגה. תחילת לפני – הליגה למנהל רישום -

למשחק. שחקנים שני הזמנת -

המשחק. תורות ניהול -

מהלכים. חוקיות אימות -

לליגה. ודיווח תוצאה על הכרזה -

(פורטים במערכת שופטים מספר להיות יכולים .8001 פורט על MCP כשרת פועל השופט

© Dr. Segal Yoram - שמורות הזכויות כל 16



.(8010–8001

PlayerAgent – שחקן סוכן 2.2.3

על: אחראי הוא בליגה. שחקן מייצג השחקן סוכן

לליגה. הרשמה -

למשחקים. הזמנות קבלת -

במשחק. מהלכים בחירת -

תוצאות. לפי פנימי מצב עדכון -

.(8104–8101) נפרד פורט על פועל שחקן כל

בפרוטוקול מזהים 2.3

ייחודי. באופן מזוהה במערכת רכיב כל

הליגה בפרוטוקול מזהים :1 טבלה

תיאור סוג המזהה שם

ייחודי ליגה מזהה String league_id

בליגה מחזור מספר Integer round_id

בודד משחק מזהה String match_id

המשחק סוג String game_type

שחקן מזהה String player_id

שופט מזהה String referee_id

שיחה מזהה String conversation_id

למזהים דוגמאות 2.3.1

”league_2025_even_odd” :league_id -

... ,3 ,2 ,1 :round_id -

(1 משחק ,1 (מחזור ”R1M1” :match_id -

”tic_tac_toe” או ”even_odd” :game_type -

”P20” ,... ,”P02” ,”P01” :player_id -

... ,”REF02” ,”REF01” :referee_id -

17 © Dr. Segal Yoram - שמורות הזכויות כל



Envelope – כללי הודעה מבנה 2.4

המעטפת קבועים. שדות עם (Envelope) “מעטפת” לכלול חייבת בפרוטוקול הודעה כל

ההודעות. אחר מעקב ומאפשרת עקביות מבטיחה

Envelope – הודעה מעטפת מבנה

{

"protocol": "league.v2",

"message_type": "GAME_INVITATION",

"sender": "referee:REF01",

"timestamp": "2025­01­15T10:30:00Z",

"conversation_id": "conv­r1m1­001",

"auth_token": "tok_abc123def456...",

"league_id": "league_2025_even_odd",

"round_id": 1,

"match_id": "R1M1"

}

במעטפת חובה שדות 2.4.1

הודעה בכל חובה שדות :2 טבלה

תיאור סוג שדה

גרסת
הפרוטוקול, String protocol

”league.v2” קבוע

ההודעה סוג
(למשל

String message_type
GAME_IN­
(VITATION

השולח מזהה
String sender

type:id בפורמט

ISO­ זמן חותמת
זמן באזור 8601 String timestamp

UTC

שיחה מזהה
String conversation_id

ייחודי

© Dr. Segal Yoram - שמורות הזכויות כל 18



UTC/GMT – זמן אזור דרישת 2.4.2

מבטיחה זו דרישה .UTC/GMT זמן באזור להיות חייבות בפרוטוקול הזמן חותמות כל חובה:

שונים. גיאוגרפיים ממיקומים הפועלים סוכנים בין עקביות

זמן לחותמת תקינים ולא תקינים פורמטים :3 טבלה

הסבר תקין? פורמט

UTC מציינת Z סיומת X 2025­01­15T10:30:00Z

ערך שווה +00:00 הפרש
X 2025­01­15T10:30:00+00:00

UTC-ל

אסור – מקומי זמן אזור × 2025­01­15T10:30:00+02:00

אסור – זמן אזור ללא × 2025­01­15T10:30:00

IN­) E021 שגיאה יקבל UTC שאינו זמן אזור עם הודעה ששולח סוכן חשובה: הערה

.(VALID_TIMESTAMP

אופציונליים שדות 2.4.3

הקשר לפי אופציונליים שדות :4 טבלה

תיאור סוג שדה

אימות טוקן
לאחר (חובה String auth_token

רישום)

הליגה מזהה String league_id

מחזור מספר Integer round_id

משחק מזהה String match_id

sender שדה פורמט 2.4.4

ההודעה: שולח את מזהה sender שדה

הליגה. מנהל – league_manager -

.REF01 מזהה עם שופט – referee:REF01 -

.P01 מזהה עם שחקן – player:P01 -

19 © Dr. Segal Yoram - שמורות הזכויות כל



auth_token – אימות טוקן 2.4.5

שנשלחת הודעה בכל להופיע חייב הטוקן .auth_token מקבל סוכן כל מוצלח, רישום לאחר

אחרים. לסוכנים התחזות מונע זה הרישום. לאחר

רישום בתגובת טוקן קבלת

{

"message_type": "LEAGUE_REGISTER_RESPONSE",

"status": "ACCEPTED",

"player_id": "P01",

"auth_token": "tok_p01_abc123def456ghi789..."

}

הכללית הליגה זרימת 2.5

שופטים רישום :1 שלב 2.5.1

מנהל הליגה. למנהל רישום בקשת שולח השופט לליגה. נרשם שופט כל הראשון, בשלב

השופט. כתובת את ושומר referee_id מקצה הליגה

REFEREE_REGISTER_REQUEST
Referee League Manager

REFEREE_REGISTER_RESPONSE

שחקנים רישום :2 שלב 2.5.2

הליגה. למנהל רישום בקשת שולח השחקן לליגה. נרשם שחקן כל השופטים, רישום לאחר

ומאשר. player_id מקצה הליגה מנהל

REGISTER_REQUEST
Player Agent League Manager

REGISTER_RESPONSE

משחקים לוח יצירת :3 שלב 2.5.3

שיטת על מבוסס הלוח משחקים. לוח יוצר הליגה מנהל נרשמו, השחקנים שכל לאחר

אחר. שחקן כל נגד משחק שחקן כל .Round­Robin

מחזור על הכרזה :4 שלב 2.5.4

מפרטת ההודעה .ROUND_ANNOUNCEMENT הודעת מפרסם הליגה מנהל מחזור, כל לפני

השופטים רשימת מתוך משחק לכל שופט מקצה הליגה מנהל במחזור. המשחקים כל את

הרשומים.

© Dr. Segal Yoram - שמורות הזכויות כל 20



משחקים ניהול :5 שלב 2.5.5

הוא בסיום, המשחק. חוקי לפי המשחק את מנהל הוא למשחק. שחקנים מזמין השופט

הליגה. למנהל תוצאה מדווח

דירוג עדכון :6 שלב 2.5.6

לכל הטבלה את מפרסם הוא הדירוג. טבלת את מעדכן הליגה מנהל מחזור, כל לאחר

השחקנים.

כללית זרימה דיאגרמת 2.6

Start

Register Referees

Register Players

Create Schedule

More Yes
Run Match

Matches?

No

Update Standings

End

Timeouts – תגובה זמני 2.7

נחשבת הפעולה בזמן, עונה לא הסוכן אם מקסימלי. תגובה זמן מוגדר הודעה סוג לכל

לכישלון.

21 © Dr. Segal Yoram - שמורות הזכויות כל



הודעה סוג לפי תגובה זמני :5 טבלה

הערות Timeout הודעה סוג

REFEREE_REGIS­
לליגה שופט רישום 10 sec

TER

לליגה שחקן רישום 10 sec LEAGUE_REGISTER

למשחק הגעה אישור 5 sec GAME_JOIN_ACK

זוגי/אי-זוגי בחירת 30 sec CHOOSE_PARITY

משחק תוצאת קבלת 5 sec GAME_OVER

MATCH_RE­
לליגה תוצאה דיווח 10 sec

SULT_REPORT

מידע שאילתת 10 sec LEAGUE_QUERY

מחדל ברירת 10 sec השאר כל

Agent Lifecycle – סוכן של חיים מחזור 2.8

הליגה. במהלך מוגדרים מצבים עובר שופט) (שחקן, סוכן כל

הסוכן מצבי 2.8.1

נרשם. טרם אך הופעל הסוכן – INIT -

.auth_token וקיבל בהצלחה נרשם הסוכן – REGISTERED -

במשחקים. ומשתתף פעיל הסוכן – ACTIVE -

מגיב). (לא זמנית מושעה הסוכן – SUSPENDED -

פעילות. סיים הסוכן – SHUTDOWN -

מצבים מעברי דיאגרמת 2.8.2

register league_start
INIT REGISTERED ACTIVE

lea
gue

_en
d

error timeout
recover

SHUTDOWN max_fail SUSPENDED

© Dr. Segal Yoram - שמורות הזכויות כל 22



בשגיאות טיפול 2.9

שגיאה: הודעות סוגי שני מגדיר הפרוטוקול

LEAGUE_ERROR – ליגה שגיאת 2.9.1

הליגה. ברמת שגיאה מתרחשת כאשר זו הודעה שולח הליגה מנהל

ליגה שגיאת דוגמת

{

"protocol": "league.v2",

"message_type": "LEAGUE_ERROR",

"sender": "league_manager",

"timestamp": "2025­01­15T10:35:00Z",

"error_code": "E005",

"error_name": "PLAYER_NOT_REGISTERED",

"error_description": "Player ID not found in registry",

"context": {

"player_id": "P99"

},

"retryable": false

}

GAME_ERROR – משחק שגיאת 2.9.2

במשחק. שגיאה מתרחשת כאשר זו הודעה שולח השופט

משחק שגיאת דוגמת

{

"protocol": "league.v2",

"message_type": "GAME_ERROR",

"sender": "referee:REF01",

"timestamp": "2025­01­15T10:31:00Z",

"match_id": "R1M1",

"player_id": "P01",

"error_code": "E001",

"error_name": "TIMEOUT_ERROR",

"error_description": "Response not received within 30 seconds",

"game_state": "COLLECTING_CHOICES",

"retryable": true,

"retry_count": 1,

"max_retries": 3

}

23 © Dr. Segal Yoram - שמורות הזכויות כל



נפוצים שגיאה קודי 2.9.3

עיקריים שגיאה קודי :6 טבלה

תיאור שם קוד

בזמן התקבלה לא תגובה TIMEOUT_ERROR E001

MISSING_RE­
חסר חובה שדה E003

QUIRED_FIELD

INVALID_PAR­
חוקית לא בחירה E004

ITY_CHOICE

PLAYER_NOT_REG­
רשום לא שחקן E005

ISTERED

CONNECTION_ER­
בחיבור כשל E009

ROR

AUTH_TO­
חסר אימות טוקן E011

KEN_MISSING

AUTH_TOKEN_IN­
תקין לא טוקן E012

VALID

Retry Policy – חוזר ניסיון מדיניות 2.9.4

חוזר: לניסיון ניתנות מסוימות שגיאות

3 ניסיונות: מקסימום -

שניות 2 ניסיונות: בין השהייה -

(noitcennoc) E009 ,(tuoemit) E001 לניסיון: הניתנות שגיאות -

.(TECHNICAL_LOSS) טכני הפסד – הניסיונות מיצוי לאחר

גרסאות תאימות 2.10

© Dr. Segal Yoram - שמורות הזכויות כל 24



גרסה הכרזת 2.10.1

בודק הליגה מנהל בה. תומך שהוא הפרוטוקול גרסת על מכריז סוכן כל רישום, בעת

הרישום. אישור לפני תאימות

רישום בבקשת גרסה הכרזת

{

"message_type": "LEAGUE_REGISTER_REQUEST",

"player_meta": {

"display_name": "Agent Alpha",

"version": "1.0.0",

"protocol_version": "2.1.0",

"game_types": ["even_odd"]

}

}

תאימות מדיניות 2.10.2

2.1.0 נוכחית: גרסה -

2.0.0 נתמכת: מינימלית גרסה -

(PROTOCOL_VERSION_MIS­ E018 שגיאת יקבלו יותר ישנה גרסה עם סוכנים -

.MATCH)

חשובים עקרונות 2.11

יחיד אמת מקור 2.11.1

מסתמכים הם משלהם. מצב שומרים לא שחקנים המשחק. למצב האמת מקור הוא השופט

שולח. שהשופט המידע על

Orchestrator דרך תקשורת 2.11.2

הליגה. מנהל או השופט דרך עוברת התקשורת כל זה. עם זה ישירות מדברים לא שחקנים

נשמר. שהפרוטוקול מבטיח זה

בכשלים טיפול 2.11.3

מגיב: לא שחקן אם

.retryable=true עם GAME_ERROR הודעת שולח השופט .1

ניסיונות. 3 עד מקבל השחקן .2

.(TECHNICAL_LOSS) טכני הפסד – הניסיונות מיצוי לאחר .3

25 © Dr. Segal Yoram - שמורות הזכויות כל



זוגי/אי-זוגי משחק 3

המשחק תיאור 3.1

הליגה. פרוטוקול להדגמת מתאים המשחק פשוט. משחק הוא זוגי/אי-זוגי משחק

המשחק חוקי 3.1.1

במשחק. משתתפים שחקנים שני .1

.(odd) “אי-זוגי” או (even) “זוגי” בוחר שחקן כל .2

היריב. בחירת את לדעת בלי במקביל, נעשות הבחירות .3

ל-10. 1 בין מספר מגריל השופט .4

מנצח. “זוגי” שבחר מי – זוגי המספר אם .5

מנצח. “אי-זוגי” שבחר מי – אי-זוגי המספר אם .6

תיקו. – ופספסו דבר אותו בחרו שניהם אם .7

למשחק דוגמה 3.1.2

:B לשחקן A שחקן בין משחק נניח

זוגי/אי-זוגי למשחק דוגמה :7 טבלה

תוצאה מספר B בחירת A בחירת

מנצח A 8 (even) odd even

מנצח B 7 (odd) odd even

תיקו 4 (even) odd odd

בודד משחק זרימת 3.2

למשחק הזמנה :1 שלב 3.2.1

כוללת: ההזמנה השחקנים. לשני הזמנה שולח השופט

.(match_id) המשחק מזהה -

.(round_id) המחזור מזהה -

.(game_type) המשחק סוג -

© Dr. Segal Yoram - שמורות הזכויות כל 26



הגעה אישור :2 שלב 3.2.2

זמן. חותמת כולל האישור ההזמנה. קבלת מאשר שחקן כל

בחירות איסוף :3 שלב 3.2.3

את מחזיר השחקן “אי-זוגי”. או “זוגי” בחירה: מבקש הוא בנפרד. שחקן לכל פונה השופט

בחירתו.

היריב. בחירת את רואים לא השחקנים חשוב:

מספר הגרלת :4 שלב 3.2.4

חייבת ההגרלה ל-10. 1 בין הוא המספר מספר. מגריל השופט הבחירות, שתי קבלת לאחר

אקראית. להיות

מנצח קביעת :5 שלב 3.2.5

בודק: השופט

מנצח. הוא – “זוגי” בחר ושחקן זוגי המספר אם -

מנצח. הוא – “אי-זוגי” בחר ושחקן אי-זוגי המספר אם -

תיקו. – נכון נכון/לא ניחשו שניהם אם -

תוצאה דיווח :6 שלב 3.2.6

שולח: השופט

השחקנים. לשני GAME_OVER הודעת .1

הליגה. למנהל MATCH_RESULT_REPORT הודעת .2

המשחק מצבי 3.3

מוגדרים: מצבים בין עובר המשחק

WAITING Both ACK COLLECTING Both chose DRAWING

FOR_PLAYERS CHOICES NUMBER

Result

FINISHED

WAITING_FOR_PLAYERS מצב 3.3.1

השחקנים כששני המעבר: הגעה. יאשרו שהשחקנים מחכה השופט זה. במצב מתחיל המשחק

.GAME_JOIN_ACK שלחו

27 © Dr. Segal Yoram - שמורות הזכויות כל



COLLECTING_CHOICES מצב 3.3.2

המעבר: שחקן. כל של choose_parity-ל קורא הוא מהשחקנים. בחירות אוסף השופט

התקבלו. הבחירות כששתי

DRAWING_NUMBER מצב 3.3.3

החישוב. לאחר אוטומטי המעבר: מנצח. וקובע מספר מגריל השופט

FINISHED מצב 3.3.4

דווחה. התוצאה הסתיים. המשחק

הניקוד שיטת 3.4

למשחק ניקוד 3.4.1

ניקוד טבלת :8 טבלה

מפסיד נקודות מנצח נקודות תוצאה

0 3 ניצחון

1 1 תיקו

0 0 הפסד

בליגה דירוג 3.4.2

לפי: נקבע הדירוג

(יורד). הנקודות סך .1

(יורד). הניצחונות מספר .2

(יורד). תיקו הפרש .3

Round­Robin ליגת 3.5

כולם. נגד משחק שחקן כל שחקנים, 4 עם בליגה

משחקים מספר 3.5.1

שחקנים: n עבור

n(n−1) בליגה: משחקים מספר -
2

משחקים 4×3 = 6 שחקנים: 4 עבור -
2

© Dr. Segal Yoram - שמורות הזכויות כל 28



לדוגמה משחקים לוח 3.5.2

שחקנים ל-4 משחקים לוח :9 טבלה

B שחקן A שחקן משחק

P02 P01 R1M1

P04 P03 R1M2

P03 P01 R2M1

P04 P02 R2M2

P04 P01 R3M1

P03 P02 R3M2

לשחקנים אסטרטגיות 3.6

אקראית אסטרטגיה 3.6.1

.50% הוא לנצח הסיכוי “אי-זוגי”. או “זוגי” באקראי בוחר השחקן ביותר. הפשוטה הגישה

אקראית אסטרטגיה

import random

def choose_parity_random():

return random.choice(["even", "odd"])

היסטוריה מבוססת אסטרטגיה 3.6.2

בהגרלות. דפוסים לזהות מנסה הוא קודמות. תוצאות זוכר השחקן

ארוך. לטווח תוצאות תשפר לא זו אסטרטגיה אקראית, שההגרלה מכיוון הערה:

LLM מונחית אסטרטגיה 3.6.3

המודל. את ושואל prompt בונה הוא שפה. במודל להשתמש יכול השחקן

prompt-ל דוגמה

prompt = """

You are playing Even/Odd game.

Choose "even" or "odd".

Previous results: even won 3 times, odd won 2 times.

Your choice (one word only):

"""

29 © Dr. Segal Yoram - שמורות הזכויות כל



משחק הוא המשחק סטטיסטית. ביצועים ישפר לא אך מעניין LLM-ב השימוש הערה:

מזל.

המשחק חוקי מודול 3.7

למשחק. הספציפית הלוגיקה את מגדיר הוא בשופט. נפרד רכיב הוא החוקים מודול

המודול ממשק 3.7.1

פונקציות: מספק המודול

משחק. מצב אתחול – init_game_state() -

בחירה. חוקיות בדיקת – validate_choice(choice) -

מספר. הגרלת – draw_number() -

מנצח. קביעת – determine_winner(choices, number) -

ההפרדה יתרון 3.7.2

אפשר: זוגי/אי-זוגי, במקום המודול. את להחליף אפשר בעתיד,

.(Tic­Tac­Toe) איקס-עיגול -

שאלות. 21 -

זיכרון. משחק -

משתנה. החוקים מודול רק זהה. נשאר הכללי הפרוטוקול

נוספים למשחקים הרחבה 3.8

השכבה את מתאר זה סעיף זוגי/אי-זוגי. למשחק ספציפי ולא כללי להיות מתוכנן הפרוטוקול

נוספים. משחקים הוספת המאפשרת הגנרית

GAME_MOVE – מהלך הפשטת 3.8.1

של פרטי מקרה הן CHOOSE_PARITY_RESPONSE-ו CHOOSE_PARITY_CALL הודעות

יותר: כללית הפשטה

לגנריות ספציפיות הודעות בין הקבלה :10 טבלה

גנרית הודעה ספציפית הודעה

GAME_MOVE_CALL CHOOSE_PARITY_CALL

GAME_MOVE_RE­ CHOOSE_PARITY_RE­
SPONSE SPONSE

© Dr. Segal Yoram - שמורות הזכויות כל 30



גנרית מהלך הודעת מבנה 3.8.2

GAME_MOVE_CALL – גנרית מהלך בקשת

{

"protocol": "league.v2",

"message_type": "GAME_MOVE_CALL",

"sender": "referee:REF01",

"timestamp": "2025­01­15T10:30:15Z",

"match_id": "R1M1",

"player_id": "P01",

"game_type": "even_odd",

"move_request": {

"move_type": "choose_parity",

"valid_options": ["even", "odd"],

"context": {}

},

"deadline": "2025­01­15T10:30:45Z"

}

GAME_MOVE_RESPONSE – גנרית מהלך תגובת

{

"protocol": "league.v2",

"message_type": "GAME_MOVE_RESPONSE",

"sender": "player:P01",

"timestamp": "2025­01­15T10:30:20Z",

"match_id": "R1M1",

"player_id": "P01",

"game_type": "even_odd",

"move_data": {

"move_type": "choose_parity",

"choice": "even"

}

}

31 © Dr. Segal Yoram - שמורות הזכויות כל



Game Registry – משחקים סוגי רישום 3.8.3

נתמכים: משחקים סוגי של רישום מחזיק הליגה מנהל

משחקים רישום

{

"game_registry": {

"even_odd": {

"display_name": "Even/Odd",

"move_types": ["choose_parity"],

"valid_choices": {

"choose_parity": ["even", "odd"]

},

"min_players": 2,

"max_players": 2

},

"tic_tac_toe": {

"display_name": "Tic­Tac­Toe",

"move_types": ["place_mark"],

"valid_choices": {

"place_mark": ["0­8"]

},

"min_players": 2,

"max_players": 2

}

}

}

ההפשטה יתרונות 3.8.4

הבסיסי. בפרוטוקול שינוי ללא – חדשים משחקים הוספת .1

נתמכים. משחקים אילו לשאול יכול שחקן – יכולות גילוי .2

.schema-ה לפי חוקי שהמהלך מוודא השופט – אחידה וולידציה .3

ספציפיות. הודעות עם לעבוד להמשיך יכולים ישנים סוכנים – קדימה תאימות .4

ההפשטה .(CHOOSE_PARITY_*) הספציפיות בהודעות משתמשים זה בתרגיל הערה:

הארכיטקטורה. הבנת לצורך מוצגת הגנרית

© Dr. Segal Yoram - שמורות הזכויות כל 32



JSON הודעות מבני 4
להשתמש חייבים הסטודנטים כל מאוד: חשוב הפרוטוקול. הודעות כל את מגדיר זה פרק

זה. עם זה לתקשר שלכם לסוכנים יאפשר זה בדיוק. אלה במבנים

לליגה שופט רישום הודעות 4.1

REFEREE_REGISTER_REQUEST – שופט רישום בקשת 4.1.1

(שופט) referee :)From( מאת -

הליגה) (מנהל league_manager :)To( אל -

REFEREE_REGISTER_RESPONSE צפויה: תגובה -

הליגה. תחילת לפני הליגה למנהל זו בקשה שולח שופט

לליגה שופט רישום בקשת

{

"message_type": "REFEREE_REGISTER_REQUEST",

"referee_meta": {

"display_name": "Referee Alpha",

"version": "1.0.0",

"game_types": ["even_odd"],

"contact_endpoint": "http://localhost:8001/mcp",

"max_concurrent_matches": 2

}

}

חובה: שדות

השופט. של תצוגה שם – display_name -

השופט. גרסת – version -

לשפוט. יודע שהשופט משחקים סוגי רשימת – game_types -

השופט. של השרת כתובת – contact_endpoint -

במקביל. לנהל יכול שהשופט מקסימלי משחקים מספר – max_concurrent_matches -

33 © Dr. Segal Yoram - שמורות הזכויות כל



REFEREE_REGISTER_RESPONSE – שופט רישום תגובת 4.1.2

הליגה) (מנהל league_manager :)From( מאת -

הבקשה) את ששלח (השופט referee :)To( אל -

תגובה) (הודעת אין צפויה: תגובה -

לשופט. זו תגובה מחזיר הליגה מנהל

לליגה שופט רישום תגובת

{

"message_type": "REFEREE_REGISTER_RESPONSE",

"status": "ACCEPTED",

"referee_id": "REF01",

"reason": null

}

שדות:

.”REJECTED” או ”ACCEPTED” – status -

התקבל). אם (רק לשופט שהוקצה מזהה – referee_id -

נדחה). אם (רק דחייה סיבת – reason -

© Dr. Segal Yoram - שמורות הזכויות כל 34



לליגה שחקן רישום הודעות 4.2

LEAGUE_REGISTER_REQUEST – שחקן רישום בקשת 4.2.1

(שחקן) player :)From( מאת -

הליגה) (מנהל league_manager :)To( אל -

LEAGUE_REGISTER_RESPONSE צפויה: תגובה -

הליגה. למנהל זו בקשה שולח שחקן

לליגה רישום בקשת

{

"message_type": "LEAGUE_REGISTER_REQUEST",

"player_meta": {

"display_name": "Agent Alpha",

"version": "1.0.0",

"game_types": ["even_odd"],

"contact_endpoint": "http://localhost:8101/mcp"

}

}

חובה: שדות

השחקן. של תצוגה שם – display_name -

הסוכן. גרסת – version -

נתמכים. משחקים רשימת – game_types -

השחקן. של השרת כתובת – contact_endpoint -

35 © Dr. Segal Yoram - שמורות הזכויות כל



LEAGUE_REGISTER_RESPONSE – רישום תגובת 4.2.2

הליגה) (מנהל league_manager :)From( מאת -

הבקשה) את ששלח (השחקן player :)To( אל -

תגובה) (הודעת אין צפויה: תגובה -

זו. תגובה מחזיר הליגה מנהל

לליגה רישום תגובת

{

"message_type": "LEAGUE_REGISTER_RESPONSE",

"status": "ACCEPTED",

"player_id": "P01",

"reason": null

}

שדות:

.”REJECTED” או ”ACCEPTED” – status -

התקבל). אם (רק לשחקן שהוקצה מזהה – player_id -

נדחה). אם (רק דחייה סיבת – reason -

© Dr. Segal Yoram - שמורות הזכויות כל 36



מחזור הודעות 4.3

ROUND_ANNOUNCEMENT – מחזור הכרזת 4.3.1

הליגה) (מנהל league_manager :)From( מאת -

הרשומים) השחקנים (כל players :)To( אל -

שידור) (הודעת אין צפויה: תגובה -

מחזור. כל לפני שולח הליגה מנהל

מחזור הכרזת

{

"message_type": "ROUND_ANNOUNCEMENT",

"league_id": "league_2025_even_odd",

"round_id": 1,

"matches": [

{

"match_id": "R1M1",

"game_type": "even_odd",

"player_A_id": "P01",

"player_B_id": "P02",

"referee_endpoint": "http://localhost:8001/mcp"

},

{

"match_id": "R1M2",

"game_type": "even_odd",

"player_A_id": "P03",

"player_B_id": "P04",

"referee_endpoint": "http://localhost:8001/mcp"

}

]

}

משחק הודעות 4.4

37 © Dr. Segal Yoram - שמורות הזכויות כל



GAME_INVITATION – למשחק הזמנה 4.4.1

המשחק) את המנהל (השופט referee :)From( מאת -

במשחק) השחקנים משני אחד (כל player :)To( אל -

GAME_JOIN_ACK צפויה: תגובה -

שחקן. לכל שולח השופט

למשחק הזמנה

{

"message_type": "GAME_INVITATION",

"league_id": "league_2025_even_odd",

"round_id": 1,

"match_id": "R1M1",

"game_type": "even_odd",

"role_in_match": "PLAYER_A",

"opponent_id": "P02",

"conversation_id": "conv­r1m1­001"

}

GAME_JOIN_ACK – הגעה אישור 4.4.2

הזמנה) שקיבל (השחקן player :)From( מאת -

ההזמנה) את ששלח (השופט referee :)To( אל -

מאשרים) השחקנים שכל (לאחר CHOOSE_PARITY_CALL צפויה: תגובה -

ההזמנה. קבלת מאשר השחקן

למשחק הגעה אישור

{

"message_type": "GAME_JOIN_ACK",

"match_id": "R1M1",

"player_id": "P01",

"arrival_timestamp": "2025­01­15T10:30:00Z",

"accept": true

}

זוגי/אי-זוגי במשחק בחירה הודעות 4.5

© Dr. Segal Yoram - שמורות הזכויות כל 38



CHOOSE_PARITY_CALL – בחירה בקשת 4.5.1

(השופט) referee :)From( מאת -

במשחק) מהשחקנים אחד (כל player :)To( אל -

CHOOSE_PARITY_RESPONSE צפויה: תגובה -

לבחור. מהשחקן מבקש השופט

בחירה בקשת

{

"message_type": "CHOOSE_PARITY_CALL",

"match_id": "R1M1",

"player_id": "P01",

"game_type": "even_odd",

"context": {

"opponent_id": "P02",

"round_id": 1,

"your_standings": {

"wins": 2,

"losses": 1,

"draws": 0

}

},

"deadline": "2025­01­15T10:30:30Z"

}

CHOOSE_PARITY_RESPONSE – בחירה תגובת 4.5.2

(השחקן) player :)From( מאת -

הבקשה) את ששלח (השופט referee :)To( אל -

ענו) השחקנים שכל (לאחר GAME_OVER צפויה: תגובה -

בחירתו. את מחזיר השחקן

בחירה תגובת

{

"message_type": "CHOOSE_PARITY_RESPONSE",

"match_id": "R1M1",

"player_id": "P01",

"parity_choice": "even"

}

בדיוק. ”odd” או ”even” להיות חייב parity_choice של הערך חשוב:

39 © Dr. Segal Yoram - שמורות הזכויות כל



תוצאה הודעות 4.6

GAME_OVER – משחק סיום 4.6.1

(השופט) referee :)From( מאת -

במשחק) השחקנים (שני players :)To( אל -

עדכון) (הודעת אין צפויה: תגובה -

השחקנים. לשני שולח השופט

משחק סיום הודעת

{

"message_type": "GAME_OVER",

"match_id": "R1M1",

"game_type": "even_odd",

"game_result": {

"status": "WIN",

"winner_player_id": "P01",

"drawn_number": 8,

"number_parity": "even",

"choices": {

"P01": "even",

"P02": "odd"

},

"reason": "P01 chose even, number was 8 (even)"

}

}

:status-ל אפשריים ערכים

מנצח. יש – ”WIN” -

תיקו. – ”DRAW” -

וכד’). תגובה, (זמן טכני הפסד – ”TECHNICAL_LOSS” -

© Dr. Segal Yoram - שמורות הזכויות כל 40



MATCH_RESULT_REPORT – לליגה תוצאה דיווח 4.6.2

המשחק) את שניהל (השופט referee :)From( מאת -

הליגה) (מנהל league_manager :)To( אל -

השחקנים) לכל ישדר הליגה (מנהל LEAGUE_STANDINGS_UPDATE צפויה: תגובה -

הליגה. למנהל שולח השופט

לליגה תוצאה דיווח

{

"message_type": "MATCH_RESULT_REPORT",

"league_id": "league_2025_even_odd",

"round_id": 1,

"match_id": "R1M1",

"game_type": "even_odd",

"result": {

"winner": "P01",

"score": {

"P01": 3,

"P02": 0

},

"details": {

"drawn_number": 8,

"choices": {

"P01": "even",

"P02": "odd"

}

}

}

}

דירוג הודעות 4.7

41 © Dr. Segal Yoram - שמורות הזכויות כל



LEAGUE_STANDINGS_UPDATE – דירוג עדכון 4.7.1

הליגה) (מנהל league_manager :)From( מאת -

הרשומים) השחקנים (כל players :)To( אל -

שידור) (הודעת אין צפויה: תגובה -

השחקנים. לכל שולח הליגה מנהל

דירוג טבלת עדכון

{

"message_type": "LEAGUE_STANDINGS_UPDATE",

"league_id": "league_2025_even_odd",

"round_id": 1,

"standings": [

{

"rank": 1,

"player_id": "P01",

"display_name": "Agent Alpha",

"played": 2,

"wins": 2,

"draws": 0,

"losses": 0,

"points": 6

},

{

"rank": 2,

"player_id": "P03",

"display_name": "Agent Gamma",

"played": 2,

"wins": 1,

"draws": 1,

"losses": 0,

"points": 4

}

]

}

וליגה מחזור סיום הודעות 4.8

© Dr. Segal Yoram - שמורות הזכויות כל 42



ROUND_COMPLETED – מחזור סיום 4.8.1

הליגה) (מנהל league_manager :)From( מאת -

הרשומים) השחקנים (כל players :)To( אל -

שידור) (הודעת אין צפויה: תגובה -

מחזור. בסיום המשתתפים לכל זו הודעה שולח הליגה מנהל

מחזור סיום הודעת

{

"protocol": "league.v2",

"message_type": "ROUND_COMPLETED",

"sender": "league_manager",

"timestamp": "2025­01­15T12:00:00Z",

"conversation_id": "conv­round1­complete",

"league_id": "league_2025_even_odd",

"round_id": 1,

"matches_completed": 2,

"next_round_id": 2,

"summary": {

"total_matches": 2,

"wins": 1,

"draws": 1,

"technical_losses": 0

}

}

שדות:

שהסתיים. המחזור – round_id -

שהושלמו. משחקים מספר – matches_completed -

האחרון. המחזור זה אם null או הבא, המחזור – next_round_id -

המחזור. של סטטיסטי סיכום – summary -

43 © Dr. Segal Yoram - שמורות הזכויות כל



LEAGUE_COMPLETED – ליגה סיום 4.8.2

הליגה) (מנהל league_manager :)From( מאת -

ושופטים) שחקנים – הסוכנים (כל all_agents :)To( אל -

סופית) שידור (הודעת אין צפויה: תגובה -

הליגה. בסיום הסוכנים לכל זו הודעה שולח הליגה מנהל

ליגה סיום הודעת

{

"protocol": "league.v2",

"message_type": "LEAGUE_COMPLETED",

"sender": "league_manager",

"timestamp": "2025­01­20T18:00:00Z",

"conversation_id": "conv­league­complete",

"league_id": "league_2025_even_odd",

"total_rounds": 3,

"total_matches": 6,

"champion": {

"player_id": "P01",

"display_name": "Agent Alpha",

"points": 9

},

"final_standings": [

{"rank": 1, "player_id": "P01", "points": 9},

{"rank": 2, "player_id": "P03", "points": 5},

{"rank": 3, "player_id": "P02", "points": 3},

{"rank": 4, "player_id": "P04", "points": 1}

]

}

שדות:

האלוף. פרטי – champion -

הסופית. הדירוג טבלת – final_standings -

הליגה. סטטיסטיקות – total_matches ,total_rounds -

שאילתא הודעות 4.9

© Dr. Segal Yoram - שמורות הזכויות כל 44



LEAGUE_QUERY – ליגה שאילתת 4.9.1

שופט) או (שחקן referee או player :)From( מאת -

הליגה) (מנהל league_manager :)To( אל -

LEAGUE_QUERY_RESPONSE צפויה: תגובה -

מידע. לקבלת הליגה למנהל שאילתה שולח שופט או שחקן

הבא המשחק שאילתת

{

"protocol": "league.v2",

"message_type": "LEAGUE_QUERY",

"sender": "player:P01",

"timestamp": "2025­01­15T14:00:00Z",

"conversation_id": "conv­query­001",

"auth_token": "tok_p01_abc123...",

"league_id": "league_2025_even_odd",

"query_type": "GET_NEXT_MATCH",

"query_params": {

"player_id": "P01"

}

}

:)query_type( שאילתות סוגי

דירוג. טבלת קבלת – GET_STANDINGS -

משחקים. לוח קבלת – GET_SCHEDULE -

הבא. המשחק פרטי קבלת – GET_NEXT_MATCH -

שחקן. סטטיסטיקות קבלת – GET_PLAYER_STATS -

45 © Dr. Segal Yoram - שמורות הזכויות כל



LEAGUE_QUERY_RESPONSE – שאילתה תגובת 4.9.2

הליגה) (מנהל league_manager :)From( מאת -

המקורי) (השולח referee או player :)To( אל -

תגובה) (הודעת אין צפויה: תגובה -

לשאילתה. תגובה מחזיר הליגה מנהל

הבא המשחק תגובת

{

"protocol": "league.v2",

"message_type": "LEAGUE_QUERY_RESPONSE",

"sender": "league_manager",

"timestamp": "2025­01­15T14:00:01Z",

"conversation_id": "conv­query­001",

"query_type": "GET_NEXT_MATCH",

"success": true,

"data": {

"next_match": {

"match_id": "R2M1",

"round_id": 2,

"opponent_id": "P03",

"referee_endpoint": "http://localhost:8001/mcp"

}

}

}

שדות:

הצליחה. השאילתה האם – success -

.(query_type לפי משתנה (מבנה השאילתה תוצאת – data -

.success=false אם שגיאה פרטי – error -

שגיאה הודעות 4.10

© Dr. Segal Yoram - שמורות הזכויות כל 46



הליגה ברמת שגיאה – LEAGUE_ERROR 4.10.1

הליגה) (מנהל league_manager :)From( מאת -

לשגיאה) שגרם (הסוכן agent :)To( אל -

שגיאה) (הודעת אין צפויה: תגובה -

:LEAGUE_ERROR הודעת שולח הליגה מנהל ליגה, בפעולות שגיאה מתרחשת כאשר

LEAGUE_ERROR – ליגה שגיאת

{

"protocol": "league.v2",

"message_type": "LEAGUE_ERROR",

"sender": "league_manager",

"timestamp": "2025­01­15T10:05:30Z",

"conversation_id": "conv­error­001",

"error_code": "E012",

"error_description": "AUTH_TOKEN_INVALID",

"original_message_type": "LEAGUE_QUERY",

"context": {

"provided_token": "tok­invalid­xxx",

"expected_format": "tok­{agent_id}­{hash}"

}

}

שדות:

השגיאה. קודי מטבלת השגיאה קוד – error_code -

השגיאה. שם – error_description -

לשגיאה. שגרמה ההודעה סוג – original_message_type -

ניפוי. לצורך נוסף מידע – context -

47 © Dr. Segal Yoram - שמורות הזכויות כל



המשחק ברמת שגיאה – GAME_ERROR 4.10.2

המשחק) את המנהל (השופט referee :)From( מאת -

ממנה) המושפע או לשגיאה שגרם (השחקן player :)To( אל -

שגיאה) (הודעת אין צפויה: תגובה -

:GAME_ERROR הודעת שולח השופט משחק, במהלך שגיאה מתרחשת כאשר

GAME_ERROR – משחק שגיאת

{

"protocol": "league.v2",

"message_type": "GAME_ERROR",

"sender": "referee:REF01",

"timestamp": "2025­01­15T10:16:00Z",

"conversation_id": "conv­r1m1­001",

"match_id": "R1M1",

"error_code": "E001",

"error_description": "TIMEOUT_ERROR",

"affected_player": "P02",

"action_required": "CHOOSE_PARITY_RESPONSE",

"retry_info": {

"retry_count": 1,

"max_retries": 3,

"next_retry_at": "2025­01­15T10:16:02Z"

},

"consequence": "Technical loss if max retries exceeded"

}

שדות:

השגיאה. אירעה בו המשחק מזהה – match_id -

המושפע. השחקן – affected_player -

שנכשלה. הפעולה – action_required -

רלוונטי). (אם חוזרים ניסיונות על מידע – retry_info -

תיפתר. לא השגיאה אם התוצאה – consequence -

הודעות סיכום טבלת 4.11

חשובים כללים 4.12

© Dr. Segal Yoram - שמורות הזכויות כל 48



v2.1 בפרוטוקול ההודעות סוגי 18 כל סיכום :11 טבלה

מטרה מקבל שולח הודעה סוג

REFEREE_REGIS­
שופט רישום ליגה שופט

TER_REQUEST

רישום אישור REFEREE_REGIS­
שופט ליגה

שופט TER_RESPONSE

LEAGUE_REGIS­
שחקן רישום ליגה שחקן

TER_REQUEST

רישום אישור LEAGUE_REGIS­
שחקן ליגה

שחקן TER_RESPONSE

ROUND_ANNOUNCE­
מחזור פרסום שחקנים ליגה

MENT

מחזור סיום שחקנים ליגה ROUND_COMPLETED

ליגה סיום כולם ליגה LEAGUE_COMPLETED

למשחק הזמנה שחקן שופט GAME_INVITATION

הגעה אישור שופט שחקן GAME_JOIN_ACK

CHOOSE_PAR­
בחירה בקשת שחקן שופט

ITY_CALL

CHOOSE_PARITY_RE­
בחירה תגובת שופט שחקן

SPONSE

משחק סיום שחקנים שופט GAME_OVER

MATCH_RESULT_RE­
תוצאה דיווח ליגה שופט

PORT

LEAGUE_STAND­
דירוג עדכון שחקנים ליגה

INGS_UPDATE

ליגה שגיאת סוכן ליגה LEAGUE_ERROR

משחק שגיאת שחקן שופט GAME_ERROR

מידע שאילתת ליגה שחקן/שופט LEAGUE_QUERY

LEAGUE_QUERY_RE­
שאילתה תגובת שחקן/שופט ליגה

SPONSE

49 © Dr. Segal Yoram - שמורות הזכויות כל



חובה שדות 4.12.1

לכלול: חייבת הודעה כל

תמיד. – message_type -

משחק. בהודעות – match_id -

שחקן. בהודעות – player_id -

מותרים ערכים 4.12.2

קטנות). (אותיות ”odd” או ”even” רק :parity_choice -

.”TECHNICAL_LOSS” או ,”DRAW” ,”WIN” רק :status -

(בוליאני). false או true רק :accept -

זמן פורמט 4.12.3

:ISO­8601 בפורמט הזמן חותמות כל

YYYY­MM­DDTHH:MM:SSZ

2025­01­15T10:30:00Z דוגמה:

© Dr. Segal Yoram - שמורות הזכויות כל 50



מימוש מדריך 5
להשתמש אפשר .FastAPI עם Python-ב הדוגמאות הסוכנים. את לממש כיצד מציג זה פרק

.HTTP-ב שתומכת שפה בכל

כללית ארכיטקטורה 5.1

רכיבים תרשים 5.1.1

Orchestrator / Host

HTTP HTTP HTTP

League Manager Referee Players

:8000 :8001 :8101­8104

Orchestrator-ה תפקיד 5.1.2

הוא: הסוכנים. כל בין מתאם Orchestrator-ה

שרת. לכל HTTP בקשות שולח -

אותן. ומעבד תגובות מקבל -

הליגה. זרימת את מנהל -

51 © Dr. Segal Yoram - שמורות הזכויות כל



פשוט MCP שרת מימוש 5.2

FastAPI-ב בסיסי מבנה 5.2.1

בסיסי MCP שרת

from fastapi import FastAPI

from pydantic import BaseModel

import uvicorn

app = FastAPI()

class MCPRequest(BaseModel):

jsonrpc: str = "2.0"

method: str

params: dict = {}

id: int = 1

class MCPResponse(BaseModel):

jsonrpc: str = "2.0"

result: dict = {}

id: int = 1

@app.post("/mcp")

async def mcp_endpoint(request: MCPRequest):

if request.method == "tool_name":

result = handle_tool(request.params)

return MCPResponse(result=result, id=request.id)

return MCPResponse(result={"error": "Unknown method"})

if __name__ == "__main__":

uvicorn.run(app, host="localhost", port=8101)

שחקן סוכן מימוש 5.3

נדרשים כלים 5.3.1

הבאים: הכלים את לממש חייב שחקן סוכן

למשחק. הזמנה קבלת – handle_game_invitation .1

“אי-זוגי”. או “זוגי” בחירת – choose_parity .2

משחק. תוצאת קבלת – notify_match_result .3

© Dr. Segal Yoram - שמורות הזכויות כל 52



לדוגמה מימוש 5.3.2

פשוט שחקן סוכן

import random

from fastapi import FastAPI

from pydantic import BaseModel

from datetime import datetime

app = FastAPI()

class MCPRequest(BaseModel):

jsonrpc: str = "2.0"

method: str

params: dict = {}

id: int = 1

@app.post("/mcp")

async def mcp_endpoint(request: MCPRequest):

if request.method == "handle_game_invitation":

return handle_invitation(request.params)

elif request.method == "choose_parity":

return handle_choose_parity(request.params)

elif request.method == "notify_match_result":

return handle_result(request.params)

return {"error": "Unknown method"}

def handle_invitation(params):

# Accept the invitation

return {

"message_type": "GAME_JOIN_ACK",

"match_id": params.get("match_id"),

"arrival_timestamp": datetime.now().isoformat(),

"accept": True

}

def handle_choose_parity(params):

# Random strategy

choice = random.choice(["even", "odd"])

return {

"message_type": "CHOOSE_PARITY_RESPONSE",

"match_id": params.get("match_id"),

"player_id": params.get("player_id"),

"parity_choice": choice

}

def handle_result(params):

# Log result for learning

print(f"Match result: {params}")
53 © Dr. Segal Yoram - שמורות הזכויות כל

return {"status": "ok"}



שופט מימוש 5.4

נדרשים כלים 5.4.1

לממש: חייב השופט

הליגה. למנהל עצמי רישום – register_to_league .1

חדש. משחק התחלת – start_match .2

משחקנים. בחירות איסוף – collect_choices .3

מספר. הגרלת – draw_number .4

ודיווח. המשחק סיום – finalize_match .5

לליגה שופט רישום 5.4.2

הליגה למנהל נרשם שופט

import requests

def register_to_league(league_endpoint, referee_info):

payload = {

"jsonrpc": "2.0",

"method": "register_referee",

"params": {

"referee_meta": {

"display_name": referee_info["name"],

"version": "1.0.0",

"game_types": ["even_odd"],

"contact_endpoint": referee_info["endpoint"],

"max_concurrent_matches": 2

}

},

"id": 1

}

response = requests.post(league_endpoint, json=payload)

result = response.json()

return result.get("result", {}).get("referee_id")

© Dr. Segal Yoram - שמורות הזכויות כל 54



מנצח קביעת לוגיקת 5.4.3

זוגי/אי-זוגי במשחק מנצח קביעת

def determine_winner(choice_a, choice_b, number):

is_even = (number % 2 == 0)

parity = "even" if is_even else "odd"

a_correct = (choice_a == parity)

b_correct = (choice_b == parity)

if a_correct and not b_correct:

return "PLAYER_A"

elif b_correct and not a_correct:

return "PLAYER_B"

else:

return "DRAW"

ליגה מנהל מימוש 5.5

נדרשים כלים 5.5.1

לממש: חייב הליגה מנהל

חדש. שופט רישום – register_referee .1

חדש. שחקן רישום – register_player .2

משחקים. לוח יצירת – create_schedule .3

תוצאה. דיווח קבלת – report_match_result .4

דירוג. טבלת החזרת – get_standings .5

55 © Dr. Segal Yoram - שמורות הזכויות כל



שופט רישום 5.5.2

הליגה במנהל שופט רישום

class LeagueManager:

def __init__(self):

self.referees = {} # referee_id ­> referee_info

self.players = {} # player_id ­> player_info

self.next_referee_id = 1

def register_referee(self, params):

referee_meta = params.get("referee_meta", {})

referee_id = f"REF{self.next_referee_id:02d}"

self.next_referee_id += 1

self.referees[referee_id] = {

"referee_id": referee_id,

"display_name": referee_meta.get("display_name"),

"endpoint": referee_meta.get("contact_endpoint"),

"game_types": referee_meta.get("game_types", []),

"max_concurrent": referee_meta.get("max_concurrent_matches",

1)

}

return {

"message_type": "REFEREE_REGISTER_RESPONSE",

"status": "ACCEPTED",

"referee_id": referee_id,

"reason": None

}

© Dr. Segal Yoram - שמורות הזכויות כל 56



משחקים לוח יצירת 5.5.3

Round­Robin אלגוריתם

from itertools import combinations

def create_schedule(players):

matches = []

round_num = 1

match_num = 1

for p1, p2 in combinations(players, 2):

matches.append({

"match_id": f"R{round_num}M{match_num}",

"player_A_id": p1,

"player_B_id": p2

})

match_num += 1

return matches

57 © Dr. Segal Yoram - שמורות הזכויות כל



HTTP בקשות שליחת 5.6

MCP לכלי קריאה 5.6.1

MCP לשרת בקשה שליחת

import requests

def call_mcp_tool(endpoint, method, params):

payload = {

"jsonrpc": "2.0",

"method": method,

"params": params,

"id": 1

}

response = requests.post(endpoint, json=payload)

return response.json()

# Example: Call player's choose_parity

result = call_mcp_tool(

"http://localhost:8101/mcp",

"choose_parity",

{"match_id": "R1M1", "player_id": "P01"}

)

© Dr. Segal Yoram - שמורות הזכויות כל 58



מצב ניהול 5.7

שחקן מצב 5.7.1

פנימי: מידע לשמור יכול השחקן

משחקים. היסטוריית -

אישיות. סטטיסטיקות -

יריבים. על מידע -

שחקן מצב מחלקת

class PlayerState:

def __init__(self, player_id):

self.player_id = player_id

self.wins = 0

self.losses = 0

self.draws = 0

self.history = []

def update(self, result):

self.history.append(result)

if result["winner"] == self.player_id:

self.wins += 1

elif result["winner"] == "DRAW":

self.draws += 1

else:

self.losses += 1

59 © Dr. Segal Yoram - שמורות הזכויות כל



בשגיאות טיפול 5.8

תגובה זמן 5.8.1

timeout עם בקשה

import requests

def call_with_timeout(endpoint, method, params, timeout=30):

try:

response = requests.post(

endpoint,

json={"jsonrpc": "2.0", "method": method,

"params": params, "id": 1},

timeout=timeout

)

return response.json()

except requests.Timeout:

return {"error": "TIMEOUT"}

except requests.RequestException as e:

return {"error": str(e)}

לשגיאות תגובה 5.8.2

עונה: לא שחקן אם

.timeout-ל עד ממתין השופט .1

טכני. הפסד – תגובה אין אם .2

הליגה. למנהל מדווח השופט .3

)Resilience Patterns( חוסן דפוסי 5.9

ניסיונות מדיניות מגדיר הפרוטוקול זמניים. כשלים עם להתמודד חייבת מבוזרת מערכת

חוזרים:

חוזרים. ניסיונות 3 מקסימום -

ניסיונות. בין שניות 2 של השהייה -

בעומס. למערכות מומלץ Exponential backoff -

© Dr. Segal Yoram - שמורות הזכויות כל 60



Backoff עם Retry מימוש 5.9.1

חוזרים ניסיונות לוגיקת

import time

import requests

from typing import Optional, Dict, Any

class RetryConfig:

MAX_RETRIES = 3

BASE_DELAY = 2.0 # seconds

BACKOFF_MULTIPLIER = 2.0

def call_with_retry(endpoint: str, method: str,

params: Dict[str, Any]) ­> Dict[str, Any]:

"""Send MCP request with retry logic."""

last_error = None

for attempt in range(RetryConfig.MAX_RETRIES):

try:

response = requests.post(

endpoint,

json={

"jsonrpc": "2.0",

"method": method,

"params": params,

"id": 1

},

timeout=30

)

return response.json()

except (requests.Timeout, requests.ConnectionError) as e:

last_error = e

if attempt < RetryConfig.MAX_RETRIES ­ 1:

delay = RetryConfig.BASE_DELAY * \

(RetryConfig.BACKOFF_MULTIPLIER ** attempt)

time.sleep(delay)

return {

"error": {

"error_code": "E005",

"error_description": f"Max retries exceeded: {last_error}"

}

}

61 © Dr. Segal Yoram - שמורות הזכויות כל



Circuit Breaker דפוס 5.9.2

מסוימת: לתקופה נוספים מניסיונות נמנע פעמים, מספר נכשל שרת כאשר

פשוט Circuit Breaker

from datetime import datetime, timedelta

class CircuitBreaker:

def __init__(self, failure_threshold=5, reset_timeout=60):

self.failures = 0

self.threshold = failure_threshold

self.reset_timeout = reset_timeout

self.last_failure = None

self.state = "CLOSED" # CLOSED, OPEN, HALF_OPEN

def can_execute(self) ­> bool:

if self.state == "CLOSED":

return True

if self.state == "OPEN":

if datetime.now() ­ self.last_failure > \

timedelta(seconds=self.reset_timeout):

self.state = "HALF_OPEN"

return True

return False

return True # HALF_OPEN allows one try

def record_success(self):

self.failures = 0

self.state = "CLOSED"

def record_failure(self):

self.failures += 1

self.last_failure = datetime.now()

if self.failures >= self.threshold:

self.state = "OPEN"

)Structured Logging( מובנה תיעוד 5.10

חייבת לוג הודעת כל שגיאות. וניפוי ניתוח לצורך JSON בפורמט תיעוד מחייב הפרוטוקול

הבאים: השדות את לכלול

© Dr. Segal Yoram - שמורות הזכויות כל 62



לוג בהודעת חובה שדות :12 טבלה

תיאור סוג חובה Field

האירוע זמן ISO­8601 ןכ timestamp

DEBUG/IN­
FO/WARN/ER­ string ןכ level

ROR

הסוכן מזהה string ןכ agent_id

ההודעה סוג string אל message_type

השיחה מזהה string אל conversation_id

האירוע תיאור string ןכ message

נוספים נתונים object אל data

Logger מימוש 5.10.1

מובנה Logger

import json

import sys

from datetime import datetime

from typing import Optional, Dict, Any

class StructuredLogger:

LEVELS = ["DEBUG", "INFO", "WARN", "ERROR"]

def __init__(self, agent_id: str, min_level: str = "INFO"):

self.agent_id = agent_id

self.min_level = self.LEVELS.index(min_level)

def log(self, level: str, message: str,

message_type: Optional[str] = None,

conversation_id: Optional[str] = None,

data: Optional[Dict[str, Any]] = None):

if self.LEVELS.index(level) < self.min_level:

return

log_entry = {

"timestamp": datetime.now().isoformat(),

"level": level,

"agent_id": self.agent_id,

"message": message

}63 © Dr. Segal Yoram - שמורות הזכויות כל

if message_type:

log_entry["message_type"] = message_type

if conversation_id:

log_entry["conversation_id"] = conversation_id

if data:

log_entry["data"] = data

print(json.dumps(log_entry), file=sys.stderr)

def info(self, message: str, **kwargs):

self.log("INFO", message, **kwargs)

def error(self, message: str, **kwargs):

self.log("ERROR", message, **kwargs)



לשימוש דוגמה 5.10.2

Logger-ב שימוש

logger = StructuredLogger("player:P01")

# Log received message

logger.info(

"Received game invitation",

message_type="GAME_INVITATION",

conversation_id="conv­12345",

data={"match_id": "R1M1", "opponent": "P02"}

)

# Log error

logger.error(

"Failed to connect to referee",

data={"endpoint": "http://localhost:8001", "error": "timeout"}

)

הלוג: פלט

לוג פלט

{"timestamp": "2025­01­15T10:30:00.123Z",

"level": "INFO",

"agent_id": "player:P01",

"message": "Received game invitation",

"message_type": "GAME_INVITATION",

"conversation_id": "conv­12345",

"data": {"match_id": "R1M1", "opponent": "P02"}}

)Authentication( וטוקנים אימות 5.11

הטוקן לאימות. auth_token לכלול חייבת הודעה כל הפרוטוקול, של 2.1.0 מגרסה החל

בקשה. בכל הסוכן לזיהוי ומשמש הרישום בעת מתקבל

© Dr. Segal Yoram - שמורות הזכויות כל 64



רישום בעת טוקן קבלת 5.11.1

טוקן וקבלת רישום

import requests

from dataclasses import dataclass

from typing import Optional

@dataclass

class AgentCredentials:

agent_id: str

auth_token: str

league_id: str

def register_player(league_endpoint: str,

player_info: dict) ­> Optional[AgentCredentials]:

"""Register player and store auth token."""

payload = {

"jsonrpc": "2.0",

"method": "register_player",

"params": {

"protocol": "league.v2",

"message_type": "LEAGUE_REGISTER_REQUEST",

"sender": f"player:{player_info['name']}",

"player_meta": player_info

},

"id": 1

}

response = requests.post(league_endpoint, json=payload)

result = response.json().get("result", {})

if result.get("status") == "ACCEPTED":

return AgentCredentials(

agent_id=result["player_id"],

auth_token=result["auth_token"],

league_id=result["league_id"]

)

return None

65 © Dr. Segal Yoram - שמורות הזכויות כל



בבקשות בטוקן שימוש 5.11.2

אימות עם בקשה

class AuthenticatedClient:

def __init__(self, credentials: AgentCredentials):

self.creds = credentials

def send_message(self, endpoint: str, message_type: str,

params: dict) ­> dict:

"""Send authenticated message."""

payload = {

"jsonrpc": "2.0",

"method": "mcp_message",

"params": {

"protocol": "league.v2",

"message_type": message_type,

"sender": f"player:{self.creds.agent_id}",

"auth_token": self.creds.auth_token,

"league_id": self.creds.league_id,

**params

},

"id": 1

}

response = requests.post(endpoint, json=payload)

return response.json()

© Dr. Segal Yoram - שמורות הזכויות כל 66



אימות בשגיאות טיפול 5.11.3

אימות בשגיאות טיפול

def handle_auth_error(response: dict) ­> bool:

"""Check for authentication errors."""

error = response.get("error", {})

error_code = error.get("error_code", "")

if error_code == "E011": # AUTH_TOKEN_MISSING

print("Error: auth_token is required")

return False

elif error_code == "E012": # AUTH_TOKEN_INVALID

print("Error: auth_token is invalid or expired")

# May need to re­register

return False

elif error_code == "E013": # REFEREE_NOT_REGISTERED

print("Error: Referee must register first")

return False

return True # No auth error

מקומיות בדיקות 5.12

מקומית הרצה 5.12.1

נפרד: בטרמינל סוכן כל הריצו

הסוכנים הרצת

# Terminal 1: League Manager (start first)

python league_manager.py # Port 8000

# Terminal 2: Referee

python referee.py # Port 8001

# Terminal 3­6: Players

python player.py ­­port 8101

python player.py ­­port 8102

python player.py ­­port 8103

python player.py ­­port 8104

חשוב: הרצה סדר

לרוץ. חייב הליגה מנהל כל קודם .1

67 © Dr. Segal Yoram - שמורות הזכויות כל



ההפעלה. בעת הליגה למנהל נרשם השופט .2

הליגה. למנהל נרשמים השחקנים .3

הליגה. את להתחיל אפשר אז רק .4

חיבור בדיקת 5.12.2

שרת בדיקת

import requests

def test_server(port):

try:

r = requests.post(

f"http://localhost:{port}/mcp",

json={"jsonrpc": "2.0", "method": "ping", "id": 1}

)

print(f"Port {port}: OK")

except:

print(f"Port {port}: FAILED")

# Test all servers

for port in [8000, 8001, 8101, 8102, 8103, 8104]:

test_server(port)

למימוש טיפים 5.13

אקראית. אסטרטגיה קודם ממשו – פשוט התחילו .1

עצמכם. עם ליגה הריצו – מקומית בדקו .2

הודעה. כל תעדו – לוגים שמרו .3

.try/except-ב השתמשו – בשגיאות טפלו .4

בדיוק. JSON במבני השתמשו – הפרוטוקול אחר עקבו .5

© Dr. Segal Yoram - שמורות הזכויות כל 68



הבית תרגיל דרישות 6

התרגיל מטרת 6.1

בסביבה ירוץ שלכם הסוכן זה, בשלב זוגי/אי-זוגי. לליגת שחקן סוכן תממשו זה בתרגיל

פרוטוקול. תאימות לוודא כדי אחרים סטודנטים עם לתאם מומלץ בלבד. שלכם

לא שלכם הסוכן אחרת בדיוק. זה במסמך המוגדר בפרוטוקול השתמשו מאוד: חשוב

אחרים. עם לתקשר יוכל

הליגה), נתוני (פרוטוקול 9 פרק של להנחיות בכפוף הפרויקט את ולתכנן לבנות חובה

הפרויקט כי לוודא יש כן כמו הפרויקט). (מבנה 11 ופרק בפייתון), כלים (ערכת 10 פרק

הליגה). מערכת (הרצת 8 בפרק כמוגדר ותפקד רץ

הספר: על מבוסס זה תרגיל

המודל הקשר פרוטוקול עם מלאכותית בינה סוכני

AI Agents with Model Context Protocol

סגל יורם ד”ר מאת

December 9, 2025

לעומק. הנושא את וללמוד לקרוא מומלץ מאוד לכן

חובה משימות 6.2

שחקן סוכן מימוש :1 משימה 6.2.1

הבאים: בכלים לתמוך חייב השרת .localhost-ב פורט על שמאזין MCP שרת ממשו

.GAME_JOIN_ACK והחזרת למשחק הזמנה קבלת – handle_game_invitation .1

.CHOOSE_PARITY_RESPONSE והחזרת “אי-זוגי” או “זוגי” בחירת – choose_parity .2

פנימי. מצב ועדכון משחק תוצאת קבלת – notify_match_result .3

לליגה רישום :2 משימה 6.2.2

תכלול: הבקשה הליגה. למנהל רישום בקשת לשלוח חייב הסוכן

כינוי). או שלכם (השם ייחודי תצוגה שם -

הסוכן. גרסת -

השרת. של endpoint-ה כתובת -

עצמית בדיקה :3 משימה 6.2.3

שלכם: הסוכן את בדקו ההגשה, לפני

שחקנים. 4 עם מקומית ליגה הריצו .1

69 © Dr. Segal Yoram - שמורות הזכויות כל



הודעה. סוג לכל מגיב שהסוכן ודאו .2

לפרוטוקול. תואמות JSON-ה שתבניות ודאו .3

טכניות דרישות 6.3

תכנות שפת 6.3.1

שהסוכן: העיקר שתרצו. שפה כל לבחור יכולים אתם

.HTTP שרת מממש -

./mcp בנתיב POST לבקשות מגיב -

.JSON­RPC 2.0 בפורמט JSON מחזיר -

תגובה זמני 6.3.2

שניות. 5 תוך – GAME_JOIN_ACK -

שניות. 30 תוך – CHOOSE_PARITY_RESPONSE -

שניות. 10 תוך – אחרת תגובה כל -

יציבות 6.3.3

חייב: הסוכן

קריסות. ללא לפעול -

קלט. בשגיאות לטפל -

ליגה. באמצע לפעול להפסיק לא -

העבודה תהליך 6.4

מקומי פיתוח :1 שלב 6.4.1

הסוכן. את ממשו .1

שלכם. הקוד עם מקומית בדקו .2

באגים. תקנו .3

פרטית ליגה :2 שלב 6.4.2

הסוכן. של עותקים 4 עם מקומית ליגה הריצו .1

עובדת. התקשורת שכל בדקו .2

(אופציונלי). האסטרטגיה את שפרו .3

© Dr. Segal Yoram - שמורות הזכויות כל 70



אחרים סטודנטים עם תאימות בדיקת :3 שלב 6.4.3

סוכנים. להחלפת אחר סטודנט עם תאמו .1

כראוי. ביניהם מתקשרים שהסוכנים בדקו .2

לפרוטוקול. תואמות JSON-ה שתבניות ודאו .3

כיתה ליגת לעתיד: מבט 6.4.4

חשובה הערה

שתידרשו: ייתכן בעתיד,

זוגי/אי­זוגי(. רק )לא חדשים משחקים ליצור ­

הקורס. של המסכם מהפרויקט כחלק כיתה בליגת להתחרות ­

הרחבה שתאפשר גמישה בצורה הסוכן את ולבנות לכך להיערך עליכם שינויים. וייתכנו נסגר טרם זה נושא

עתידית.

הגשה 6.5

להגשה קבצים 6.5.1

הסוכן. של מקור קוד .1

הרצה. הוראות עם README קובץ .2

הכולל: מפורט דוח .3

והמימוש. הארכיטקטורה של מלא תיאור -

לבחירה. והסיבות שנבחרה האסטרטגיה תיאור -

שמצאתם. והפתרונות בהם שנתקלתם קשיים -

והבדיקות. הפיתוח תהליך של תיעוד -

לשיפור. והמלצות מהתרגיל מסקנות -

הגשה פורמט 6.5.2

שהוגשו כפי הרגיל ההגשה בנוהל להגיש ויש ציבורי. כשהוא לריפוזיטורי קישור להגיש יש

הקודמים. התרגילים

העבודה לבדיקת כלליים דגשים 6.6

ייבדקו: הבאים הקריטריונים הרגילות, לדרישות מעבר

71 © Dr. Segal Yoram - שמורות הזכויות כל



לבדיקה קריטריונים :13 טבלה

קריטריון תיאור

בסיסי תפקוד במשחקים משחק להודעות, עונה עובד, הסוכן

פרוטוקול תאימות לפרוטוקול בדיוק תואמות JSON תבניות

יציבות בשגיאות מטפל קורס, לא יציב, הסוכן

קוד איכות מאורגן מתועד, נקי, קוד

תיעוד מפורט תיאור ברורות, הרצה הוראות

אסטרטגיה אקראי) רק (לא מעניינת אסטרטגיה מימוש

נפוצות שאלות 6.7

חיצוניות? בספריות להשתמש אפשר האם 6.7.1

התקנה. הוראות מספקים שאתם ודאו שתרצו. ספרייה בכל להשתמש יכולים אתם כן.

?Python-ב להשתמש חייבים האם 6.7.2

הפרוטוקול. בדרישות עומד שהסוכן העיקר לכם. שמתאימה שפה בכל השתמשו לא.

קורס? שלי הסוכן אם קורה מה 6.7.3

מהליגה. יוצא הוא – לפעולה חוזר לא הוא אם הנוכחי. במשחק טכני הפסד יספוג הסוכן

ההגשה? אחרי הסוכן את לעדכן אפשר האם 6.7.4

מגישים. שאתם לפני היטב בדקו סופית. ההגשה לא.

שלי? הדירוג מה אדע איך 6.7.5

שלכם. הסוכן של המיקום את לראות תוכלו מחזור. כל לאחר תפורסם הדירוג טבלת

© Dr. Segal Yoram - שמורות הזכויות כל 72



סיכום 6.8

בפרוטוקול. שעומד שחקן סוכן ממשו .1

הגשה. לפני מקומית בדקו .2

והדוח. הקוד את הגישו .3

הכיתה. בליגת ישחק שלכם הסוכן .4

בהצלחה!

נוסף: מידע

סגל. יורם לד”ר פנו ובירורים לשאלות

.[1] ”MCP עם AI “סוכני הספר את לקרוא מומלץ

.[2] הרשמי התיעוד את ראו MCP פרוטוקול על נוספים לפרטים

73 © Dr. Segal Yoram - שמורות הזכויות כל



הליגה תרגיל דרך MCP למידת 7
להבנת שלם פדגוגי מודל מהווה הוא תכנות. תרגיל רק אינו זוגי/אי-זוגי ליגת תרגיל

עקרונות את מלמד התרגיל כיצד נסביר זה בפרק .AI סוכני ועקרונות MCP פרוטוקול

.MCP ופרוטוקול AI סוכני של היסוד

AI כסוכן השחקן 7.1

?AI סוכן הוא השחקן סוכן האם 7.1.1

באמת הוא בליגה (Player Agent) השחקן סוכן האם היא: לשאול שיש הראשונה השאלה

כן. חד-משמעית: היא התשובה ?AI סוכן

מטרות להשיג מנת על הסביבה עם אינטראקציה המקיימת כישות מוגדר AI סוכן

הוא AI סוכן מראש, קבועות הוראות המבצעת רגילה מתוכנית להבדיל .[1] מוגדרות

על לבצע מה בעצמה ומחליטה אותו, מעבדת מהסביבה, מידע שמקבלת אוטונומית תוכנה

הנוכחי. המצב בסיס

AI סוכן של המאפיינים ארבעת 7.1.2

:AI סוכן של העיקריים המאפיינים ארבעת לאור בליגה השחקן סוכן את נבחן

באופן מחליט השחקן סוכן המשחק, בהקשר עצמאי. באופן פועל הסוכן – אוטונומיות .1

אומר לא אחד אף .(odd) “אי-זוגי” או (even) “זוגי” לבחור: אסטרטגיה איזו אוטונומי

לבחור. מה לו

למשחק הזמנה הודעות קולט השחקן מהסביבה. מידע קולט הסוכן – תפיסה .2

ותוצאות ,(CHOOSE_PARITY_CALL) זוגיות לבחירת בקשות ,(GAME_INVITATION)

הליגה. ומנהל מהשופט (GAME_OVER) משחקים

בחירות שליחת ידי על פעולות מבצע השחקן הסביבה. על משפיע הסוכן – פעולה .3

למשחקים. (GAME_JOIN_ACK) הגעה ואישורי (CHOOSE_PARITY_RESPONSE)

את ולעדכן במשחקים לנצח לשחק, היא מטרתו מוגדרת. מטרה לו יש – תכליתיות .4

והפסדים. ניצחונות היסטוריית כגון הפנימי, מצבו

האסטרטגיה את לבחור כדי (LLM) גדול שפה במודל להשתמש אף יכול השחקן סוכן

הפעולה. ביצוע לפני מסקנות” “הסקת או “חשיבה” מדגים הוא בכך ביותר. הטובה

MCP בארכיטקטורת השחקן 7.2

© Dr. Segal Yoram - שמורות הזכויות כל 74



לקוח? או שרת 7.2.1

.MCP שרת בעיקרו הוא השחקן זוגי/אי-זוגי, ליגת בארכיטקטורת

“משאבים” ,(Tools) “כלים” המכונים ושירותים, יכולות שחושף הרכיב הוא MCP שרת

מוגדר פורט על הפועל נפרד כתהליך מוגדר השרת .(Prompts) “הנחיות” או (Resources)

.[2] החיצון לעולם “שער” ומספק

שהוא הכלים ./mcp בנתיב POST בקשות שמקבל HTTP שרת לממש נדרש השחקן סוכן

כוללים: לממש מחויב שהשחקן הכלים .JSON­RPC 2.0 פרוטוקול באמצעות נקראים חושף

למשחק. בהזמנה טיפול – handle_game_invitation -

“אי-זוגי”. או “זוגי” בחירת – choose_parity -

המשחק. תוצאת על הודעה קבלת – notify_match_result -

הליגה ומנהל השופט מול היחסים 7.2.2

הליגה, במערכת .(Client) הלקוח הוא לשירותיו שקורא מי שרת, הוא שהשחקן בהינתן

אורקסטרטורים או כלקוחות שפועלים הם (LeagueManager) הליגה ומנהל (Referee) השופט

.(Orchestrators)

השחקן. של choose_parity לכלי הקוראת JSON­RPC-ה בקשת את שיוצר זה הוא השופט

CHOOSE_PARITY_CALL בקשת שולח הוא מהשחקנים, בחירות לאסוף רוצה השופט כאשר

שחקן. לכל

פרוטוקול מימוש מבחינת אוטונומי, AI סוכן הוא השחקן שסוכן פי על אף לסיכום:

המרכזיים. לאורקסטרטורים יכולות המציע השרת תפקיד את ממלא הוא ,MCP

AI כסוכני הליגה ומנהל השופט 7.3

גבוהה בדרגה סוכנים 7.3.1

מאפיינים: ארבעה באותם עומדים הם .AI כסוכני מוגדרים הליגה ומנהל השופט גם

ומטרות לכללים בהתאם כולה המערכת את מנהלים הם פסיביים. אינם הללו הסוכנים

.AI סוכן של והתכליתיות האוטונומיות מהות זוהי קבועות.

כלקוחות גם שפועלים MCP שרתי 7.3.2

:MCP כשרתי מוגדרים הללו הסוכנים שני

,register_referee כמו כלים מממש הוא .8000 בפורט MCP כשרת פועל הליגה מנהל -

.report_match_result-ו register_player

start_match כמו כלים מממש הוא .8001 בפורט MCP כשרת פועל השופט -

.collect_choices-ו

גם לפעול חייבים כשרתים, מוגדרים שהם אף הליגה, ומנהל השופט חשובה: הערה

לדוגמה: המרכזי. תפקידם את למלא כדי MCP כלקוחות

75 © Dr. Segal Yoram - שמורות הזכויות כל



הליגה ומנהל השופט עבור IA סוכן מאפייני :14 טבלה

מאפיין ליגה מנהל שופט

רישום כולה, הליגה ניהול הליגה, למנהל רישום
יצירת ושחקנים, שופטים בודד, משחק ניהול

תכליתיות
חישוב משחקים, לוח מהלכים, חוקיות אימות

דירוג מנצח קביעת

עצמאי באופן פועל
לליגה עצמאי באופן נרשם

אוטונומיות ולקביעת שופטים לרישום
המשחק שלבי את ומנהל

משחק סבבי

רישום בקשות קולט
הגעה, אישורי קולט

ומשחקנים, משופטים
תפיסה זוגיות/אי-זוגיות בחירות

תוצאות דוחות
מהשחקנים

מהשופטים

שופטים רישום מאשר רישום בקשת שולח
הכרזות שולח ושחקנים, הזמנות שולח לליגה,

פעולה
טבלאות מעדכן מחזור, בחירה, בקשות משחק,

דירוג תוצאות מדווח

REFEREE_REGISTER_RE­) הליגה למנהל להירשם כדי כלקוח לפעול חייב השופט -

.(QUEST

השחקן. סוכן של choose_parity לכלי לקרוא כדי כלקוח לפעול חייב השופט -

השחקנים. לסוכני המחזור הכרזות את לשלוח כדי כלקוח לפעול חייב הליגה מנהל -

צריכים הם כאשר לקוחות-אורקסטרטורים למעשה הם המרכזיים השרתים זו, במערכת

השחקנים. שרתי אצל פעולה להניע

מרכזית תובנה התפקידים: היפוך 7.4

המסורתית הפרדיגמה 7.4.1

והשרת בקשות, ששולח האקטיבי הרכיב הוא הלקוח הטיפוסית, שרת-לקוח בארכיטקטורת

יצירתי. תפקידים היפוך מתקיים ,AI-ה בליגת לבקשות. שמחכה הפסיבי הרכיב הוא

בליגה התפקידים היפוך 7.4.2

שצריכה האוטונומית הישות הוא שהשחקן למרות השרת: הוא האוטונומי( )הסוכן השחקן

.MCP כשרת יכולותיו את לחשוף נדרש הוא פעולה, לבצע

האורקסטרטור הוא השופט הלקוחות: הם )האורקסטרטורים( הליגה ומנהל השופט

הבא המהלך את להניע כדי השחקן של choose_parity לכלי וקורא MCP כלקוח שפועל

במשחק.

© Dr. Segal Yoram - שמורות הזכויות כל 67



Player 1 Player 2

(MCP Server) (MCP Server)

:8101 :8102

choose_parity choose_parity

Referee (Orchestrator)

Acts as MCP Client

:8001

ROUND_ANNOUNCEMENT

League Manager

Acts as MCP Client

:8000

השכבות הפרדת עקרון 7.5

נפרדות שכבות שלוש 7.5.1

התפקידים: בין ברורה הפרדה מאפשר MCP פרוטוקול

(Round­ משחקים לוח שחקנים, גיוס – הליגה) מנהל ידי על (מנוהלת הליגה שכבת .1

דירוג. וטבלת ,Robin)

מהלכים. ואימות בודד משחק ניהול – השופט) ידי על (מנוהלת השיפוט שכבת .2

למשחק הספציפית הלוגיקה – נפרד) מודול ידי על (מנוהלת המשחק חוקי שכבת .3

זוגי/אי-זוגי.

ההפרדה של היתרון 7.5.2

מאפשר ,(HTTP גבי על JSON­RPC 2.0) סטנדרטי MCP ממשק חושף שהוא בכך השחקן,

שלו. הפנימית לאסטרטגיה או הפיתוח לשפת אגנוסטית להישאר לליגה

אינטגרציה בעבר נדרשה מודל ולכל סוכן לכל שבה הפרגמנטציה לבעיית פתרון זהו

.[2] אוניברסלי ממשק יצירת ידי על זאת פותר MCP פרוטוקול ייחודית.

במבנה מגיעים הנתונים ,CHOOSE_PARITY_CALL כמו בקשה מקבל השחקן כאשר

זה קבוע. במבנה כן גם ,CHOOSE_PARITY_RESPONSE עם מגיב השחקן קבוע. JSON

עקבי באופן לתקשר יכול הנתונים, את מחשב הוא שבו לאופן קשר ללא סוכן, כל כי מבטיח

הפרוטוקול. את המכבד אחר אורקסטרטור כל עם

77 © Dr. Segal Yoram - שמורות הזכויות כל



השרת בסוכן LLM-ה תפקיד 7.6

הדילמה 7.6.1

הוא שני, מצד יכולות. שחושף MCP כשרת מוגדר השחקן אחד, מצד מעניינת: שאלה עולה

בהגדרות אסטרטגיה. לבחירת כ“מוח” LLM-ב להשתמש שיכול אוטונומי AI כסוכן מתואר

בקשה. ממלא אלא “מוח” מפעיל אינו שרת מסורתיות,

תפקידים הפרדת הפתרון: 7.6.2

מושגים הם (מוח/כלים) AI-ה ומרכיבי (לקוח/שרת) MCP שתפקידי בהבנה טמון הפתרון

משלימים. אך נפרדים

וגם שרת גם בפועל הוא מהסוכנים אחד כל )בפועל(: לקוח וגם שרת גם הוא הסוכן

לקרוא אחרים לסוכנים לאפשר כדי עצמו את המארח סוכן לכל נדרש השרת תפקיד לקוח.

אינטראקציה. ליזום שצריך סוכן לכל נדרש הלקוח תפקיד לכליו.

מממש השחקן סוכן אם .AI סוכן של “המוח” הוא גדול שפה מודל פנימי: כרכיב LLM-ה

הכללית. הסוכן לולאת בתוך פנימי רכיב פשוט הוא LLM-ה ,MCP שרת

:choose_parity בקשת מקבל השרת כאשר

הבקשה. את קולטת (השרת) MCP-ה שכבת .1

הבחירה. לקביעת מופעלת אחרת) אסטרטגיה או LLM-ה) הסוכן של הפנימית הלוגיקה .2

בחזרה. התגובה את שולחת (השרת) MCP-ה שכבת .3

המרכזי הרעיון שרת-לקוח. מודל את מפר אינו והוא השרת, של “הבינה” הוא LLM-ה

תישאר החיצונית התקשורת השרת, בתוך נמצא ה“מוח” כאשר שגם להבטיח הוא MCP-ב

.JSON­RPC באמצעות סטנדרטית

לקוחות שירות תחנת אנלוגיה: 7.6.3

לקוחות: שירות כתחנת הארכיטקטורה את לדמיין ניתן

.(HTTP על JSON­RPC) מדברים שבה והשפה הטלפון הוא – )פרוטוקול( MCP -

משלו. טלפון קו עם השירות משרד הוא – )שרת( השחקן -

את שמקבל המשרד, בתוך היושב החכם היועץ הוא – )המוח( LLM/האסטרטגיה -

בחזרה. לשלוח תשובה איזו MCP-ה לשכבת ומכתיב המענה, את מחשב השיחה,

אלא ,MCP לפרוטוקול ישירות חשופים אינם והלוגיקה) LLM-ה) הפנימיים הכלים

.choose_parity כגון חושף, שהסוכן הציבוריים הכלים את משרתים

האורקסטרטור תפקיד 7.7

© Dr. Segal Yoram - שמורות הזכויות כל 78



הארכיטקט – הליגה מנהל 7.7.1

שכבת את המנהל אסטרטגית, מבחינה ביותר הגבוהה בדרגה AI-ה סוכן הוא הליגה מנהל

וטבלת משחקים לוח הכללי: בניהול אלא עצמם, המשחק בחוקי מעורב אינו הוא הליגה.

דירוג.

(Tic­ לאיקס-עיגול מזוגי/אי-זוגי המשחק את להחליף תרצה הליגה אם ההפרדה: יתרון

התפקידים הפרדת עקרון של מושלמת הדגמה זוהי ישתנה. ולא כמעט הליגה מנהל ,Tac­Toe)

.MCP-ה שמקדם

הדינמי המיישם – השופט 7.7.2

מודול ידי על (שמטופלים המשחק כללי את יודע אינו הוא השיפוט. שכבת את מגלם השופט

השחקנים. בין (Conversation Lifecycle) השיחה ניהול על אחראי הוא אלא נפרד),

את שמפעיל זה הוא .(Deadlines) התגובה במועדי עומדים שהשחקנים מוודא השופט

מניע ובכך שלהם choose_parity לכלי קורא הוא – השחקנים עבור החיצונית הסוכן לולאת

השחקן. של האוטונומית הפעולה את

ה“איך” על אחראים הליגה ומנהל השופט הברורה: התפקידים חלוקת את מאפשר MCP

והתוכן). (האסטרטגיה ה“מה” על אחראים השחקנים בעוד והתקשורת), (הפרוטוקול

מלמד התרגיל מה 7.8

AI סוכני של יסוד עקרונות 7.8.1

מעשי: באופן AI סוכן של המאפיינים ארבעת את מלמד התרגיל

בעצמו. מחליט השחקן – אוטונומיות -

מהמערכת. הודעות קולט השחקן – תפיסה -

תגובות. שולח השחקן – פעולה -

לנצח. שואף השחקן – תכליתיות -

MCP של יסוד עקרונות 7.8.2

:MCP פרוטוקול של הליבה עקרונות את מלמד התרגיל

.JSON­RPC 2.0 דרך כלים חושף סוכן כל – סטנדרטי ממשק .1

המשחק. חוקי ושכבת השיפוט, שכבת הליגה, שכבת – תפקידים הפרדת .2

תכנות. שפת בכל סוכן לממש ניתן – לשפה אגנוסטיות .3

מנהל או השופט דרך אלא ישירות, מדברים לא סוכנים – אורקסטרטור דרך תקשורת .4

הליגה.

המשחקים. תחילת לפני הליגה למנהל נרשמים שחקנים וגם שופטים גם – סוכנים רישום .5

79 © Dr. Segal Yoram - שמורות הזכויות כל



הלמידה חוויית 7.8.3

יבין: הסטודנט התרגיל, בסיום

אחרים. סוכנים עם מתקשר AI סוכן כיצד -

פשוט. MCP שרת לבנות כיצד -

.MCP בפרוטוקול (Tools) “הכלים” משמעות מהי -

סוכנים. בין אינטראקציה מנהל אורקסטרטור כיצד -

.AI מערכות לתכנון חשובה שכבות הפרדת מדוע -

סיכום 7.9

.AI וסוכני MCP פרוטוקול להבנת מושלם פדגוגי מודל מהווה זוגי/אי-זוגי ליגת תרגיל

בלוגיקה להסתבך מבלי הארכיטקטוניים בעקרונות להתמקד מאפשר הפשוט המשחק

מורכבת.

המאפשר יצירתי תפקידים היפוך – MCP שרת גם להיות יכול AI שסוכן לומד הסטודנט

שניתן מבטיחה לשכבות ההפרדה פעולתם. את ולהניע לסוכנים לקרוא לאורקסטרטור

הכללי. הפרוטוקול את לשנות מבלי בעתיד הליגה משחק את להחליף

התיעוד ואת [1] ”MCP עם AI “סוכני הספר את ראו ,MCP פרוטוקול על נוספים לפרטים

.[2] Anthropic של הרשמי

© Dr. Segal Yoram - שמורות הזכויות כל 80



הליגה מערכת הרצת 8
את להפעיל כיצד נדגים המלאה. הליגה מערכת להרצת מעשית הדרכה מציג זה נספח

הדוגמאות שחקנים. וארבעה שופטים שני אחד, ליגה מנהל עם ליגה ולנהל הסוכנים כל

הקודמים. בפרקים המתואר league.v2 פרוטוקול על מבוססות

המערכת תצורת 8.1

וטרמינלים פורטים 8.1.1

7 נריץ זו בדוגמה .localhost-ב ייעודי פורט על נפרד HTTP כשרת פועל במערכת סוכן כל

טרמינלים:

וטרמינלים פורטים הקצאת :15 טבלה

טרמינל סוכן פורט Endpoint

1 ליגה מנהל 8000
http://localhost:8000/mcp

2 REF01 שופט 8001
http://localhost:8001/mcp

3 REF02 שופט 8002
http://localhost:8002/mcp

4 P01 שחקן 8101
http://localhost:8101/mcp

5 P02 שחקן 8102
http://localhost:8102/mcp

6 P03 שחקן 8103
http://localhost:8103/mcp

7 P04 שחקן 8104
http://localhost:8104/mcp

האורקסטרטורים תפקידי 8.1.2

:Orchestrator סוגי שני במערכת

לוח הדירוג, לטבלת האמת מקור הוא הליגה. של עליון Orchestrator – הליגה מנהל -

המחזורים. ומצב המשחקים

למצב האמת מקור הוא שופט כל בודד. למשחק מקומיים Orchestratorים – השופטים -

שלו. המשחק

81 © Dr. Segal Yoram - שמורות הזכויות כל



הפעלה סדר 8.2

ההפעלה סדר עקרון 8.2.1

המערכת: של תקין לתפקוד קריטי ההפעלה סדר

ראשון. לעלות חייב – הליגה מנהל .1

הליגה. למנהל ונרשמים עולים – שופטים .2

הליגה. למנהל ונרשמים עולים – שחקנים .3

הרישומים. כל השלמת לאחר רק – הליגה תחילת .4

הליגה מנהל – 1 טרמינל 8.2.2

הליגה מנהל הפעלת

# Terminal 1 ­ League Manager

python league_manager.py # Listening on :8000

.http://localhost:8000/mcp בכתובת POST לבקשות מאזין הליגה מנהל

שופטים – 2­3 טרמינלים 8.2.3

שופטים הפעלת

# Terminal 2 ­ Referee Alpha

python referee.py ­­port 8001

# Terminal 3 ­ Referee Beta

python referee.py ­­port 8002

REF­ ששולחת register_to_league פונקציה מפעיל עלייתו, בעת שופט, כל

הליגה. למנהל EREE_REGISTER_REQUEST

© Dr. Segal Yoram - שמורות הזכויות כל 82



שחקנים – 4­7 טרמינלים 8.2.4

שחקנים הפעלת

# Terminal 4 ­ Player P01

python player.py ­­port 8101

# Terminal 5 ­ Player P02

python player.py ­­port 8102

# Terminal 6 ­ Player P03

python player.py ­­port 8103

# Terminal 7 ­ Player P04

python player.py ­­port 8104

הליגה. למנהל LEAGUE_REGISTER_REQUEST שולח שחקן כל

שופטים רישום :1 שלב 8.3

הליגה. למנהל הלקוח מצד קורא שלו, השרת עליית עם מיד שופט, כל

שופט רישום בקשת 8.3.1

REFEREE_REGISTER_REQUEST – שופט רישום בקשת

{

"jsonrpc": "2.0",

"method": "register_referee",

"params": {

"protocol": "league.v2",

"message_type": "REFEREE_REGISTER_REQUEST",

"sender": "referee:alpha",

"timestamp": "2025­01­15T10:00:00Z",

"conversation_id": "conv­ref­alpha­reg­001",

"referee_meta": {

"display_name": "Referee Alpha",

"version": "1.0.0",

"game_types": ["even_odd"],

"contact_endpoint": "http://localhost:8001/mcp",

"max_concurrent_matches": 2

}

},

"id": 1

}

83 © Dr. Segal Yoram - שמורות הזכויות כל



הליגה מנהל תגובת 8.3.2

REFEREE_REGISTER_RESPONSE – שופט רישום תגובת

{

"jsonrpc": "2.0",

"result": {

"protocol": "league.v2",

"message_type": "REFEREE_REGISTER_RESPONSE",

"sender": "league_manager",

"timestamp": "2025­01­15T10:00:01Z",

"conversation_id": "conv­ref­alpha­reg­001",

"status": "ACCEPTED",

"referee_id": "REF01",

"auth_token": "tok­ref01­abc123",

"league_id": "league_2025_even_odd",

"reason": null

},

"id": 1

}

.referee_id: "REF02" ומקבל דומה בקשה שולח (8002 פורט (על השני השופט

© Dr. Segal Yoram - שמורות הזכויות כל 84



שחקנים רישום :2 שלב 8.4

רישום. בקשת שולח שחקן כל נרשמו, שהשופטים לאחר

שחקן רישום בקשת 8.4.1

LEAGUE_REGISTER_REQUEST – שחקן רישום בקשת

{

"jsonrpc": "2.0",

"method": "register_player",

"params": {

"protocol": "league.v2",

"message_type": "LEAGUE_REGISTER_REQUEST",

"sender": "player:alpha",

"timestamp": "2025­01­15T10:05:00Z",

"conversation_id": "conv­player­alpha­reg­001",

"player_meta": {

"display_name": "Agent Alpha",

"version": "1.0.0",

"game_types": ["even_odd"],

"contact_endpoint": "http://localhost:8101/mcp"

}

},

"id": 1

}

85 © Dr. Segal Yoram - שמורות הזכויות כל



הליגה מנהל תגובת 8.4.2

LEAGUE_REGISTER_RESPONSE – שחקן רישום תגובת

{

"jsonrpc": "2.0",

"result": {

"protocol": "league.v2",

"message_type": "LEAGUE_REGISTER_RESPONSE",

"sender": "league_manager",

"timestamp": "2025­01­15T10:05:01Z",

"conversation_id": "conv­player­alpha­reg­001",

"status": "ACCEPTED",

"player_id": "P01",

"auth_token": "tok­p01­xyz789",

"league_id": "league_2025_even_odd",

"reason": null

},

"id": 1

}

דומה: באופן

player_id: "P02" מקבל 8102 פורט על שחקן -

player_id: "P03" מקבל 8103 פורט על שחקן -

player_id: "P04" מקבל 8104 פורט על שחקן -

referee_id ומפה contact_endpoint → player_id מפה שומר הליגה מנהל

.contact_endpoint →

משחקים לוח יצירת :3 שלב 8.5

create_schedule לוגיקת מפעיל הליגה מנהל נרשמו, והשופטים השחקנים שכל לאחר

.Round­Robin-ל השחקנים רשימת על

שחקנים לארבעה משחקים לוח 8.5.1

© Dr. Segal Yoram - שמורות הזכויות כל 86



שחקנים לארבעה Round­Robin משחקים לוח :16 טבלה

Match ID Player A Player B

R1M1 P01 P02

R1M2 P03 P04

R2M1 P03 P01

R2M2 P04 P02

R3M1 P04 P01

R3M2 P03 P02

מחזור על הכרזה :4 שלב 8.6

.ROUND_ANNOUNCEMENT הודעת השחקנים לכל שולח הליגה מנהל

87 © Dr. Segal Yoram - שמורות הזכויות כל



ROUND_ANNOUNCEMENT – מחזור על הכרזה

{

"jsonrpc": "2.0",

"method": "notify_round",

"params": {

"protocol": "league.v2",

"message_type": "ROUND_ANNOUNCEMENT",

"sender": "league_manager",

"timestamp": "2025­01­15T10:10:00Z",

"conversation_id": "conv­round­1­announce",

"league_id": "league_2025_even_odd",

"round_id": 1,

"matches": [

{

"match_id": "R1M1",

"game_type": "even_odd",

"player_A_id": "P01",

"player_B_id": "P02",

"referee_endpoint": "http://localhost:8001/mcp"

},

{

"match_id": "R1M2",

"game_type": "even_odd",

"player_A_id": "P03",

"player_B_id": "P04",

"referee_endpoint": "http://localhost:8001/mcp"

}

]

},

"id": 10

}

עצמם המשחקים לוגית. התחיל המחזור – ROUND_ANNOUNCEMENT שנשלחה מרגע

המשתתפים. את מזמין השופט כאשר רק מתחילים

בודד משחק ניהול :5 שלב 8.7

.REF01 שופט ,P02 שחקן נגד P01 שחקן :R1M1 המשחק זרימת את נתאר

© Dr. Segal Yoram - שמורות הזכויות כל 88



למשחק הזמנה :5.1 שלב 8.7.1

GAME_INVITATION ושולח WAITING_FOR_PLAYERS-ל המשחק מצב את מעביר השופט

שחקן. לכל

:P01-ל הזמנה

P01-ל GAME_INVITATION – למשחק הזמנה

{

"jsonrpc": "2.0",

"method": "handle_game_invitation",

"params": {

"protocol": "league.v2",

"message_type": "GAME_INVITATION",

"sender": "referee:REF01",

"timestamp": "2025­01­15T10:15:00Z",

"conversation_id": "conv­r1m1­001",

"auth_token": "tok­ref01­abc123",

"league_id": "league_2025_even_odd",

"round_id": 1,

"match_id": "R1M1",

"game_type": "even_odd",

"role_in_match": "PLAYER_A",

"opponent_id": "P02"

},

"id": 1001

}

:P02-ל הזמנה

89 © Dr. Segal Yoram - שמורות הזכויות כל



P02-ל GAME_INVITATION – למשחק הזמנה

{

"jsonrpc": "2.0",

"method": "handle_game_invitation",

"params": {

"protocol": "league.v2",

"message_type": "GAME_INVITATION",

"sender": "referee:REF01",

"timestamp": "2025­01­15T10:15:00Z",

"conversation_id": "conv­r1m1­001",

"auth_token": "tok­ref01­abc123",

"league_id": "league_2025_even_odd",

"round_id": 1,

"match_id": "R1M1",

"game_type": "even_odd",

"role_in_match": "PLAYER_B",

"opponent_id": "P01"

},

"id": 1002

}

הגעה אישורי :5.2 שלב 8.7.2

שניות. 5 תוך GAME_JOIN_ACK מחזיר שחקן כל

:P01-מ אישור

© Dr. Segal Yoram - שמורות הזכויות כל 90



P01-מ GAME_JOIN_ACK – הגעה אישור

{

"jsonrpc": "2.0",

"result": {

"protocol": "league.v2",

"message_type": "GAME_JOIN_ACK",

"sender": "player:P01",

"timestamp": "2025­01­15T10:15:01Z",

"conversation_id": "conv­r1m1­001",

"auth_token": "tok­p01­xyz789",

"match_id": "R1M1",

"player_id": "P01",

"arrival_timestamp": "2025­01­15T10:15:01Z",

"accept": true

},

"id": 1001

}

:P02-מ אישור

P02-מ GAME_JOIN_ACK – הגעה אישור

{

"jsonrpc": "2.0",

"result": {

"protocol": "league.v2",

"message_type": "GAME_JOIN_ACK",

"sender": "player:P02",

"timestamp": "2025­01­15T10:15:02Z",

"conversation_id": "conv­r1m1­001",

"auth_token": "tok­p02­def456",

"match_id": "R1M1",

"player_id": "P02",

"arrival_timestamp": "2025­01­15T10:15:02Z",

"accept": true

},

"id": 1002

}

המשחק מצב את מעביר הוא המותר, בזמן חיוביים ACK שני קיבל השופט כאשר

.COLLECTING_CHOICES-ל

91 © Dr. Segal Yoram - שמורות הזכויות כל



בחירות איסוף :5.3 שלב 8.7.3

שחקן. לכל CHOOSE_PARITY_CALL שולח השופט

:P01-ל בחירה בקשת

P01-ל CHOOSE_PARITY_CALL – בחירה בקשת

{

"jsonrpc": "2.0",

"method": "choose_parity",

"params": {

"protocol": "league.v2",

"message_type": "CHOOSE_PARITY_CALL",

"sender": "referee:REF01",

"timestamp": "2025­01­15T10:15:05Z",

"conversation_id": "conv­r1m1­001",

"auth_token": "tok­ref01­abc123",

"match_id": "R1M1",

"player_id": "P01",

"game_type": "even_odd",

"context": {

"opponent_id": "P02",

"round_id": 1,

"your_standings": {

"wins": 0,

"losses": 0,

"draws": 0

}

},

"deadline": "2025­01­15T10:15:35Z"

},

"id": 1101

}

:)"even" )בחר P01 תגובת

© Dr. Segal Yoram - שמורות הזכויות כל 92



P01-מ CHOOSE_PARITY_RESPONSE – בחירה תגובת

{

"jsonrpc": "2.0",

"result": {

"protocol": "league.v2",

"message_type": "CHOOSE_PARITY_RESPONSE",

"sender": "player:P01",

"timestamp": "2025­01­15T10:15:10Z",

"conversation_id": "conv­r1m1­001",

"auth_token": "tok­p01­xyz789",

"match_id": "R1M1",

"player_id": "P01",

"parity_choice": "even"

},

"id": 1101

}

:)"odd" )בחר P02 תגובת

P02-מ CHOOSE_PARITY_RESPONSE – בחירה תגובת

{

"jsonrpc": "2.0",

"result": {

"protocol": "league.v2",

"message_type": "CHOOSE_PARITY_RESPONSE",

"sender": "player:P02",

"timestamp": "2025­01­15T10:15:12Z",

"conversation_id": "conv­r1m1­001",

"auth_token": "tok­p02­def456",

"match_id": "R1M1",

"player_id": "P02",

"parity_choice": "odd"

},

"id": 1102

}

המשחק מצב את מעביר השופט ובזמן, תקין התקבלו הבחירות שתי כאשר

.DRAWING_NUMBER-ל

מנצח וקביעת מספר הגרלת :5.4 שלב 8.7.4

המשחק: חוקי מודול את מפעיל הוא .8 למשל ל-10, 1 בין מספר מגריל השופט

drawn_number = 8 -

93 © Dr. Segal Yoram - שמורות הזכויות כל



number_parity = "even" -

צדק → "even" = P01 בחירת -

טעה → "odd" = P02 בחירת -

winner_player_id = "P01" -

status = "WIN" -

.FINISHED-ל עובר המשחק מצב

לשחקנים סיום הודעת :5.5 שלב 8.7.5

השחקנים: לשני GAME_OVER שולח השופט

GAME_OVER – משחק סיום

{

"jsonrpc": "2.0",

"method": "notify_match_result",

"params": {

"protocol": "league.v2",

"message_type": "GAME_OVER",

"sender": "referee:REF01",

"timestamp": "2025­01­15T10:15:30Z",

"conversation_id": "conv­r1m1­001",

"auth_token": "tok­ref01­abc123",

"match_id": "R1M1",

"game_type": "even_odd",

"game_result": {

"status": "WIN",

"winner_player_id": "P01",

"drawn_number": 8,

"number_parity": "even",

"choices": {

"P01": "even",

"P02": "odd"

},

"reason": "P01 chose even, number was 8 (even)"

}

},

"id": 1201

}

כללית. תשובה ומחזיר היסטוריה) (סטטיסטיקות, פנימי מצב מעדכן שחקן כל

© Dr. Segal Yoram - שמורות הזכויות כל 94



הליגה למנהל דיווח :5.6 שלב 8.7.6

לליגה: MATCH_RESULT_REPORT מדווח השופט

MATCH_RESULT_REPORT – תוצאה דיווח

{

"jsonrpc": "2.0",

"method": "report_match_result",

"params": {

"protocol": "league.v2",

"message_type": "MATCH_RESULT_REPORT",

"sender": "referee:REF01",

"timestamp": "2025­01­15T10:15:35Z",

"conversation_id": "conv­r1m1­report",

"auth_token": "tok­ref01­abc123",

"league_id": "league_2025_even_odd",

"round_id": 1,

"match_id": "R1M1",

"game_type": "even_odd",

"result": {

"winner": "P01",

"score": {

"P01": 3,

"P02": 0

},

"details": {

"drawn_number": 8,

"choices": {

"P01": "even",

"P02": "odd"

}

}

}

},

"id": 1301

}

נקודות). 3 = (ניצחון הניקוד לטבלת בהתאם נקודות טבלת מעדכן הליגה מנהל

95 © Dr. Segal Yoram - שמורות הזכויות כל



דירוג ועדכון מחזור סיום :6 שלב 8.8

.MATCH_RESULT_REPORT התקבל המחזור משחקי לכל כאשר מסתיים 1 מספר מחזור

הליגה: מנהל

.(round_id=2-ל לעבור (אפשר סגור שהמחזור מכריז .1

שחקן. לכל played ,losses ,draws ,wins ,points דירוג: טבלת מחשב .2

.LEAGUE_STANDINGS_UPDATE הודעת השחקנים לכל שולח .3

© Dr. Segal Yoram - שמורות הזכויות כל 96



LEAGUE_STANDINGS_UPDATE – דירוג עדכון

{

"jsonrpc": "2.0",

"method": "update_standings",

"params": {

"protocol": "league.v2",

"message_type": "LEAGUE_STANDINGS_UPDATE",

"sender": "league_manager",

"timestamp": "2025­01­15T10:20:00Z",

"conversation_id": "conv­round­1­standings",

"league_id": "league_2025_even_odd",

"round_id": 1,

"standings": [

{

"rank": 1,

"player_id": "P01",

"display_name": "Agent Alpha",

"played": 1,

"wins": 1,

"draws": 0,

"losses": 0,

"points": 3

},

{

"rank": 2,

"player_id": "P03",

"display_name": "Agent Gamma",

"played": 1,

"wins": 0,

"draws": 1,

"losses": 0,

"points": 1

},

{

"rank": 3,

"player_id": "P04",

"display_name": "Agent Delta",

"played": 1,

"wins": 0,

"draws": 1,

"losses": 0,

"points": 1

},

{

"rank": 4,

"player_id": "P02",

"display_name": "Agent Beta",

"p9l7ayed": 1, © Dr. Segal Yoram - שמורות הזכויות כל
"wins": 0,

"draws": 0,

"losses": 1,

"points": 0

}

]

},

"id": 1401

}



לסמן ROUND_COMPLETED הודעת שולח הליגה מנהל הדירוג, עדכון שליחת לאחר

המחזור: סיום את

ROUND_COMPLETED – מחזור סיום

{

"jsonrpc": "2.0",

"method": "notify_round_completed",

"params": {

"protocol": "league.v2",

"message_type": "ROUND_COMPLETED",

"sender": "league_manager",

"timestamp": "2025­01­15T10:20:05Z",

"conversation_id": "conv­round­1­complete",

"league_id": "league_2025_even_odd",

"round_id": 1,

"matches_played": 2,

"next_round_id": 2

},

"id": 1402

}

© Dr. Segal Yoram - שמורות הזכויות כל 98



הליגה סיום :7 שלב 8.9

:LEAGUE_COMPLETED הודעת שולח הליגה מנהל המחזורים, כל סיום לאחר

LEAGUE_COMPLETED – ליגה סיום

{

"jsonrpc": "2.0",

"method": "notify_league_completed",

"params": {

"protocol": "league.v2",

"message_type": "LEAGUE_COMPLETED",

"sender": "league_manager",

"timestamp": "2025­01­15T12:00:00Z",

"conversation_id": "conv­league­complete",

"league_id": "league_2025_even_odd",

"total_rounds": 3,

"total_matches": 6,

"champion": {

"player_id": "P01",

"display_name": "Agent Alpha",

"points": 7

},

"final_standings": [

{"rank": 1, "player_id": "P01", "points": 7},

{"rank": 2, "player_id": "P03", "points": 5},

{"rank": 3, "player_id": "P04", "points": 4},

{"rank": 4, "player_id": "P02", "points": 2}

]

},

"id": 2001

}

בשגיאות טיפול 8.10

מתאימה. שגיאה הודעת שולחים השופט או הליגה מנהל שגיאה, מתרחשת כאשר

99 © Dr. Segal Yoram - שמורות הזכויות כל



אימות שגיאת 8.10.1

LEAGUE_ERROR – אימות שגיאת

{

"jsonrpc": "2.0",

"result": {

"protocol": "league.v2",

"message_type": "LEAGUE_ERROR",

"sender": "league_manager",

"timestamp": "2025­01­15T10:05:30Z",

"conversation_id": "conv­error­001",

"error_code": "E012",

"error_description": "AUTH_TOKEN_INVALID",

"context": {

"provided_token": "tok­invalid­xxx",

"action": "LEAGUE_QUERY"

}

},

"id": 1502

}

© Dr. Segal Yoram - שמורות הזכויות כל 100



תגובה זמן – משחק שגיאת 8.10.2

GAME_ERROR – משחק שגיאת

{

"jsonrpc": "2.0",

"method": "notify_game_error",

"params": {

"protocol": "league.v2",

"message_type": "GAME_ERROR",

"sender": "referee:REF01",

"timestamp": "2025­01­15T10:16:00Z",

"conversation_id": "conv­r1m1­001",

"match_id": "R1M1",

"error_code": "E001",

"error_description": "TIMEOUT_ERROR",

"affected_player": "P02",

"action_required": "CHOOSE_PARITY_RESPONSE",

"retry_count": 0,

"max_retries": 3,

"consequence": "Technical loss if no response after retries"

},

"id": 1103

}

זמינים שאילתות כלי 8.11

ובירור. דיבוג לצרכי לחשוף יכול סוכן שכל גנריים MCP כלי מגדיר המסמך

101 © Dr. Segal Yoram - שמורות הזכויות כל



הליגה ממנהל דירוג שאילתת 8.11.1

הליגה: למנהל קורא דירוגו את לוודא שרוצה שחקן

LEAGUE_QUERY – דירוג שאילתת

{

"jsonrpc": "2.0",

"method": "league_query",

"params": {

"protocol": "league.v2",

"message_type": "LEAGUE_QUERY",

"sender": "player:P01",

"timestamp": "2025­01­15T10:25:00Z",

"conversation_id": "conv­query­standings­001",

"auth_token": "tok­p01­xyz789",

"league_id": "league_2025_even_odd",

"query_type": "GET_STANDINGS"

},

"id": 1501

}

זהה בפורמט standings אובייקט שכולל result מחזיר הליגה מנהל

.LEAGUE_STANDINGS_UPDATE-ל

נוספים כלים 8.11.2

העדכני. הטבלה מצב את מחזיר – get_standings הליגה: במנהל כלי -

דיבוג). (לצרכי קיים משחק מצב מחזיר – get_match_state בשופט: כלי -

המשחקים. היסטוריית את נותן – get_player_state בשחקן: כלי -

© Dr. Segal Yoram - שמורות הזכויות כל 201



מלאה זרימה דיאגרמת 8.12

Start

League Manager Up

Referees Register

Players Register

Create Schedule

Round Announcement

More Yes
Run Match

Matches?

No

Update Standings

Yes More

Rounds?

No

End

103 © Dr. Segal Yoram - שמורות הזכויות כל



הסוכנים תפקידי טבלת 8.13

במערכת הסוכנים תפקידי :17 טבלה

סוכן פורט בליגה תפקיד עם מתקשר

ליגה, Orchestrator
League Manager 8000 ושחקנים שופטים

מחזורים טבלה,

Orchestrator
ahplA Referee 8001 שחקנים ליגה, מנהל

משחקים

Orchestrator
ateB Referee 8002 שחקנים ליגה, מנהל

משחקים

בוחר שחקן,
P01 Player Agent 8101 ליגה מנהל שופט,

even/odd

P02 Player Agent 8102 שחקן ליגה מנהל שופט,

P03 Player Agent 8103 שחקן ליגה מנהל שופט,

P04 Player Agent 8104 שחקן ליגה מנהל שופט,

סיכום 8.14

את: הציג זה נספח

סוכנים. ל-7 וטרמינלים פורטים הקצאת המערכת: תצורת -

שחקנים. → שופטים → ליגה מנהל ההפעלה: סדר -

.auth_token קבלת עם LEAGUE_REGISTER-ו REFEREE_REGISTER הרישום: זרימת -

.ROUND_COMPLETED-ו ROUND_ANNOUNCEMENT מחזור: ניהול -

.GAME_OVER עד GAME_INVITATION-מ משחק: ניהול -

.LEAGUE_STANDINGS_UPDATE-ו MATCH_RESULT_REPORT דירוג: עדכון -

אלוף. הכרזת עם LEAGUE_COMPLETED ליגה: סיום -

.GAME_ERROR-ו LEAGUE_ERROR בשגיאות: טיפול -

מעודכן. מידע לקבלת LEAGUE_QUERY שאילתות: -

כוללות ההודעות כל .HTTP מעל 2.0 JSON­RPC באמצעות מתבצעת התקשורת כל

timestamp ,sender ,message_type ,protocol חובה: שדות עם אחידה (Envelope) מעטפת

את מנהלים ושופטים) ליגה (מנהל האורקסטרטורים .conversation_id-ו ,(UTC זמן (באזור

רגע. בכל ההודעות זרימת

© Dr. Segal Yoram - שמורות הזכויות כל 104



הליגה נתוני פרוטוקול 9

הסוכנים חברת של הגנטי הקוד מבוא: 9.1

אנו – ליגה ומנהלי שופטים שחקנים, – אוטונומיים סוכנים של חברה בונים אנו כאשר

שלושה נדרשים כאן גם אנושית, חברה בכל כמו חדשה. דיגיטלית תרבות יוצרים למעשה

קריטיים: יסודות

הקודמים. בפרקים שהגדרנו הפרוטוקול – משותפים חוקים .1

היסטורי. מידע ולשחזר לשמור היכולת – קולקטיבי זיכרון .2

סוכן. כל של DNA-ה את שמגדירה הקונפיגורציה – גנטי קוד .3

שכבות שלוש ארכיטקטורת – ”JSON קובצי על הנתונים “בסיס את מתאר זה נספח

וליגות. סוכנים אלפי של מידה לקנה לצמוח למערכת שמאפשרת

השכבות שלוש ארכיטקטורת 9.2

סטטיות הגדרות
קונפיגורציה שכבת config/

והיסטוריה דינמי מצב
ריצה נתוני שכבת data/

ודיבוג מעקב
לוגים שכבת logs/

מנחים עקרונות 9.2.1

הבאים: בעקרונות עומד במערכת קובץ כל

חד-ערכי. מזהה מקבל ראשי אובייקט כל :)id( ייחודי מזהה -

עתידיות. מיגרציות מאפשר :)schema_version( סכמה גרסת -

.UTC/ISO­8601 בפורמט :)last_updated( זמן חותמת -

.league.v2-ל תואמים השדות כל לפרוטוקול: תאימות -

config/ – הקונפיגורציה שכבת 9.3

בעליית שנקראות סטטיות הגדרות – המערכת של הגנטי” ה“קוד את מכילה זו שכבה

הסוכנים.

105 © Dr. Segal Yoram - שמורות הזכויות כל



config/system.json – גלובלי מערכת קובץ 9.3.1

המערכת. לכל גלובליים פרמטרים מטרה: -

עליון. Orchestrator הסוכנים, כל משתמשים: -

SHARED/config/system.json מיקום: -

עבור: המחדל ברירת ערכי את מגדיר זה קובץ

וכתובות. פורטים – (network) רשת הגדרות -

.TTL-ו טוקנים – (security) אבטחה הגדרות -

.2 בפרק הפרוטוקול להגדרות תואמים – (timeouts) המתנה זמני -

הפרוטוקול. להגדרות תואמת – (retry_policy) חוזר ניסיון מדיניות -

)קטע( system.json מבנה דוגמה:

{

"schema_version": "1.0.0",

"system_id": "league_system_prod",

"protocol_version": "league.v2",

"timeouts": {

"move_timeout_sec": 30,

"generic_response_timeout_sec": 10

},

"retry_policy": {

"max_retries": 3,

"backoff_strategy": "exponential"

}

}

config/agents/agents_config.json – סוכנים רישום 9.3.2

סוכנים. אלפי של מרכזי ניהול מטרה: -

.Deployment כלי הליגה, מנהל משתמשים: -

SHARED/config/agents/agents_config.json מיקום: -

הסוכנים: חברת של האזרחים” “ספר את מכיל זה קובץ

הליגה. מנהל פרטי – league_manager -

הרשומים. השופטים כל רשימת – referees[] -

הרשומים. השחקנים כל רשימת – players[] -

© Dr. Segal Yoram - שמורות הזכויות כל 106



config/leagues/<league_id>.json – ליגה קונפיגורציית 9.3.3

לליגה. ספציפיות הגדרות מטרה: -

שופטים. הליגה, מנהל משתמשים: -

SHARED/config/leagues/league_2025_even_odd.json מיקום: -

משלה: חוקים עם עצמאית “מדינה” היא ליגה כל

)קטע( ליגה קונפיגורציית דוגמה:

{

"league_id": "league_2025_even_odd",

"game_type": "even_odd",

"status": "ACTIVE",

"scoring": {

"win_points": 3,

"draw_points": 1,

"loss_points": 0

},

"participants": {

"min_players": 2,

"max_players": 10000

}

}

config/games/games_registry.json – משחקים סוגי רישום 9.3.4

הנתמכים. המשחקים סוגי כל רישום מטרה: -

ליגה. מנהל חוקים), מודול (לטעינת שופטים משתמשים: -

SHARED/config/games/games_registry.json מיקום: -

מגדיר: משחק כל מרובים. משחקים בסוגי תומכת המערכת

ייחודי. מזהה – game_type -

לטעינה. החוקים מודול – rules_module -

לסיבוב. מקסימלי זמן – max_round_time_sec -

config/defaults/ – לסוכנים מחדל ברירות 9.3.5

סוכן. סוג לפי מחדל ברירת ערכי מטרה: -

player.json ,referee.json קבצים: -

SHARED/config/defaults/ מיקום: -

כל להגדיר מבלי סבירות הגדרות עם לפעול להתחיל חדש לסוכן מאפשרים אלה קבצים

בנפרד. פרמטר

107 © Dr. Segal Yoram - שמורות הזכויות כל



data/ – הריצה נתוני שכבת 9.4

ההיסטורי” ה“זיכרון היא הריצה נתוני שכבת הגנטי”, ה“קוד היא הקונפיגורציה שכבת אם

במערכת. שקורים האירועים כל נשמרים כאן החברה. של

data/leagues/<league_id>/standings.json – דירוג טבלת 9.4.1

הליגה. של העדכני הדירוג מצב מטרה: -

.(MATCH_RESULT_REPORT (אחרי הליגה מנהל מעדכן: -

SHARED/data/leagues/league_2025_even_odd/standings.json מיקום: -

דירוג טבלת מבנה דוגמה:

{

"schema_version": "1.0.0",

"league_id": "league_2025_even_odd",

"version": 12,

"rounds_completed": 3,

"standings": [

{

"rank": 1,

"player_id": "P01",

"display_name": "Agent Alpha",

"wins": 4, "draws": 1, "losses": 1,

"points": 13

}

]

}

data/leagues/<league_id>/rounds.json – מחזורים היסטוריית 9.4.2

שהתקיימו. המחזורים כל תיעוד מטרה: -

.(ROUND_COMPLETED (אחרי הליגה מנהל מעדכן: -

SHARED/data/leagues/league_2025_even_odd/rounds.json מיקום: -

data/matches/<league_id>/<match_id>.json – בודד משחק נתוני 9.4.3

בודד. משחק של מלא תיעוד מטרה: -

המשחק. את שניהל השופט מעדכן: -

SHARED/data/matches/league_2025_even_odd/R1M1.json מיקום: -

ומכיל: המשחק של זהות” ה“תעודת הוא זה קובץ

וזמנים. המשחק מצב – lifecycle -

© Dr. Segal Yoram - שמורות הזכויות כל 108



מהלכים). (היסטוריית שהוחלפו ההודעות כל – transcript[] -

.(GAME_OVER-ל (תואם הסופית התוצאה – result -

data/players/<player_id>/history.json – שחקן היסטוריית 9.4.4

השחקן. של אישי” “זיכרון מטרה: -

אסטרטגיה). (לבניית עצמו השחקן משתמש: -

SHARED/data/players/P01/history.json מיקום: -

שלו: האסטרטגיה לשיפור כ“זיכרון” זה בקובץ להשתמש יכול חכם שחקן

שחקן היסטוריית דוגמה:

{

"player_id": "P01",

"stats": {

"total_matches": 20,

"wins": 12, "losses": 5, "draws": 3

},

"matches": [

{

"match_id": "R1M1",

"opponent_id": "P02",

"result": "WIN",

"my_choice": "even",

"opponent_choice": "odd"

}

]

}

logs/ – הלוגים שכבת 9.5

קורה באמת מה לראות לנו מאפשרת היא – החברה של העצבים” “מערכת היא זו שכבה

המבוזרת. במערכת

109 © Dr. Segal Yoram - שמורות הזכויות כל



logs/league/<league_id>/league.log.jsonl – מרכזי ליגה לוג 9.5.1

נפרד). JSON אובייקט שורה (כל JSON Lines פורמט: -

טכנית. תמיכה ,DevOps משתמשים: -

SHARED/logs/league/league_2025_even_odd/league.log.jsonl מיקום: -

ליגה לוג רשומת דוגמה:

{

"timestamp": "2025­01­15T10:15:00Z",

"component": "league_manager",

"event_type": "ROUND_ANNOUNCEMENT_SENT",

"level": "INFO",

"details": {"round_id": 1, "matches_count": 2}

}

logs/agents/<agent_id>.log.jsonl – סוכן לוג 9.5.2

לדיבוג. פר-סוכן מעקב מטרה: -

הסוכן. מפתחי משתמשים: -

SHARED/logs/agents/P01.log.jsonl מיקום: -

של End­to­End Trace שמאפשר מה ומקבל, שולח שהוא ההודעות את מתעד סוכן כל

במערכת. אינטראקציה כל

קבצים סיכום טבלת 9.6

המשותפים בקבצים שימוש 9.7

המשותפת: בתיקייה זמינים זה בנספח המתוארים הדוגמה קובצי כל

L07/SHARED/

הקבצים שלהם. הסוכנים למימוש כבסיס אלה בקבצים להשתמש מוזמנים סטודנטים

כוללים:

קובץ. סוג לכל מלאות דוגמאות -

.league.v2 לפרוטוקול תואמים נתונים -

לפרויקט. מומלץ תיקיות מבנה -

© Dr. Segal Yoram - שמורות הזכויות כל 110



והנתונים הקונפיגורציה קובצי סיכום :18 טבלה

משתמש מטרה נתיב שכבה

הסוכנים כל גלובליים פרמטרים config/system.json קונפיג

ליגה מנהל סוכנים רישום config/agents/ קונפיג

ליגה מנהל ליגה הגדרות config/leagues/ קונפיג

שופטים משחקים רישום config/games/ קונפיג

סוכנים מחדל ברירות config/defaults/ קונפיג

data/.../stand­
כולם דירוג טבלת ריצה

ings.json

ליגה מנהל מחזורים היסטוריית data/.../rounds.json ריצה

אנליטיקה משחק פרטי data/matches/ ריצה

שחקן אישית היסטוריה data/players/ ריצה

DevOps מרכזי לוג logs/league/ לוגים

מפתחים סוכן לוג logs/agents/ לוגים

111 © Dr. Segal Yoram - שמורות הזכויות כל



סיכום 9.8

את מספקת – ולוגים ריצה, נתוני קונפיגורציה, – שהצגנו השכבות שלוש ארכיטקטורת

גדול. מידה בקנה סוכנים מערכת לבניית הנדרשת התשתית

כאן: גם אנושית, בחברה כמו

מכירים. שכולם היסודיים הכללים – ה“חוקה” היא הקונפיגורציה -

הקולקטיבי. הזיכרון – ההיסטורי” ה“ארכיון הם הריצה נתוני -

אמת. בזמן שקורה מה תיעוד – ה“עיתונות” הם הלוגים -

סדר, על שמירה תוך וליגות, סוכנים אלפי של לצמיחה המערכת את מכין זה מבנה

מעקב. ויכולת עקביות,

© Dr. Segal Yoram - שמורות הזכויות כל 112



בפייתון כלים ערכת 10

לקוד מהקונפיגורציה מבוא: 10.1

של שכבות שלוש – JSON קובצי מבוססת הנתונים ארכיטקטורת את הצגנו ב בנספח

בפועל? אלו לנתונים ניגש בודד סוכן כיצד אך ולוגים. ריצה, נתוני קונפיגורציה,

לבין JSON-ה קובצי בין שמגשרת Python ספריית – league_sdk את מציג זה נספח

מרכזיים: עיצוב דפוסי שני מיישמת הספרייה הסוכנים. משתמשים שבהם האובייקטים

.JSON-ה מבנה את שמשקפים (typed models) טיפוסיים מודלים – Dataclasses .1

לנתונים. לגישה הפשטה שכבת – Repository Pattern .2

הספרייה מבנה 10.2

league_sdk/

__init__.py לחבילה כניסה נקודת

config_models.py נתונים מחלקות

config_loader.py קונפיגורציה טעינת

repositories.py ריצה נתוני ניהול

logger.py לוגים רישום

config_models.py – טיפוסיים מודלים 10.3

Dataclasses הגישה: 10.3.1

בצורה נתונים מחלקות הגדרת שמאפשר @dataclass הדקורטור את מספקת Python 3.7+

מוגדר: טיפוס עם במחלקה לשדה הופך JSON-ב שדה כל תמציתית.

Dataclass הגדרת דוגמה:

from dataclasses import dataclass

from typing import List

@dataclass

class NetworkConfig:

base_host: str

default_league_manager_port: int

default_referee_port_range: List[int]

default_player_port_range: List[int]

113 © Dr. Segal Yoram - שמורות הזכויות כל



מערכת קונפיגורציית מודלי 10.3.2

:config/system.json-ל התואמים המודלים כל את מגדיר הקובץ

גלובלית קונפיגורציה מודלי

@dataclass

class SecurityConfig:

enable_auth_tokens: bool

token_length: int

token_ttl_hours: int

@dataclass

class TimeoutsConfig:

register_referee_timeout_sec: int

register_player_timeout_sec: int

game_join_ack_timeout_sec: int

move_timeout_sec: int

generic_response_timeout_sec: int

@dataclass

class SystemConfig:

schema_version: str

system_id: str

protocol_version: str

default_league_id: str

network: NetworkConfig

security: SecurityConfig

timeouts: TimeoutsConfig

# ...additional fields

© Dr. Segal Yoram - שמורות הזכויות כל 114



סוכנים מודלי 10.3.3

משלו: קונפיגורציה מחלקת מקבל סוכן סוג כל

סוכנים קונפיגורציית מודלי

@dataclass

class RefereeConfig:

referee_id: str

display_name: str

endpoint: str

version: str

game_types: List[str]

max_concurrent_matches: int

active: bool = True

@dataclass

class PlayerConfig:

player_id: str

display_name: str

version: str

preferred_leagues: List[str]

game_types: List[str]

default_endpoint: str

active: bool = True

115 © Dr. Segal Yoram - שמורות הזכויות כל



ליגה מודלי 10.3.4

ומשתתפים: ניקוד, תזמון, כוללות לליגה ספציפיות הגדרות

ליגה קונפיגורציית מודלי

@dataclass

class ScoringConfig:

win_points: int

draw_points: int

loss_points: int

technical_loss_points: int

tiebreakers: List[str]

@dataclass

class LeagueConfig:

schema_version: str

league_id: str

display_name: str

game_type: str

status: str

scoring: ScoringConfig

# ...additional fields

© Dr. Segal Yoram - שמורות הזכויות כל 116



ConfigLoader – קונפיגורציה טוען 10.4

מטמון עם עצלה טעינה העיקרון: 10.4.1

הקונפיגורציה קובצי – Lazy Loading-ה דפוס את מיישמת ConfigLoader המחלקה

חוזרת: לגישה במטמון ונשמרים צורך, בהם כשיש רק נטענים

ConfigLoader מבנה

class ConfigLoader:

def __init__(self, root: Path = CONFIG_ROOT):

self.root = root

self._system = None # lazy cache

self._agents = None # lazy cache

self._leagues = {} # league_id ­> LeagueConfig

def load_system(self) ­> SystemConfig:

"""Load global system configuration."""

if self._system:

return self._system

path = self.root / "system.json"

data = json.loads(path.read_text(encoding="utf­8"))

self._system = SystemConfig(...)

return self._system

הטעינה שיטות 10.4.2

הקונפיגורציה: סוגי כל לטעינת אחיד ממשק מספקת ConfigLoader

ConfigLoader של הטעינה שיטות :19 טבלה

שיטה מחזירה תיאור

load_system() SystemConfig גלובלית קונפיגורציה

load_agents() AgentsConfig הסוכנים כל רשימת

load_league(id) LeagueConfig ספציפית ליגה קונפיגורציית

load_games_reg­
GamesRegistry המשחקים סוגי רישום

istry()

117 © Dr. Segal Yoram - שמורות הזכויות כל



עזר שיטות 10.4.3

לחיפוש: נוחות שיטות מספקת המחלקה ישירה, לטעינה בנוסף

עזר שיטות

def get_referee_by_id(self, referee_id: str) ­> RefereeConfig:

"""Get a referee configuration by ID."""

agents = self.load_agents()

for ref in agents.referees:

if ref.referee_id == referee_id:

return ref

raise ValueError(f"Referee not found: {referee_id}")

def get_player_by_id(self, player_id: str) ­> PlayerConfig:

"""Get a player configuration by ID."""

agents = self.load_agents()

for player in agents.players:

if player.player_id == player_id:

return player

raise ValueError(f"Player not found: {player_id}")

Repositories – נתונים מאגרי 10.5

)Repository Pattern( המאגר דפוס 10.5.1

בנתונים מטפלת המאגרים שכבת סטטית, בקונפיגורציה מטפל ConfigLoader-ש בעוד

ספציפי. נתונים סוג של ושמירה עדכון, קריאה, על אחראי מאגר כל דינמיים.

© Dr. Segal Yoram - שמורות הזכויות כל 118



StandingsRepository – דירוג טבלת מאגר 10.5.2

דירוג טבלת מאגר

class StandingsRepository:

def __init__(self, league_id: str, data_root: Path = DATA_ROOT):

self.league_id = league_id

self.path = data_root / "leagues" / league_id / "standings.json"

self.path.parent.mkdir(parents=True, exist_ok=True)

def load(self) ­> Dict:

"""Load standings from JSON file."""

if not self.path.exists():

return {"schema_version": "1.0.0", "standings": []}

return json.loads(self.path.read_text(encoding="utf­8"))

def save(self, standings: Dict) ­> None:

"""Save standings to JSON file."""

standings["last_updated"] = datetime.utcnow().isoformat() + "Z"

self.path.write_text(json.dumps(standings, indent=2))

def update_player(self, player_id: str, result: str, points: int):

"""Update a player's standings after a match."""

standings = self.load()

# ... update logic

self.save(standings)

נוספים מאגרים 10.5.3

ריצה: נתוני לניהול נוספים מאגרים כוללת הספרייה

זמינים נתונים מאגרי :20 טבלה

מאגר קובץ תפקיד

StandingsReposi­
standings.json ליגה דירוג טבלת

tory

RoundsRepository rounds.json מחזורים היסטוריית

MatchRepository <match_id>.json בודד משחק נתוני

PlayerHisto­
history.json שחקן היסטוריית

ryRepository

119 © Dr. Segal Yoram - שמורות הזכויות כל



JsonLogger – לוגים רישום 10.6

JSON Lines פורמט 10.6.1

אובייקט היא הלוג בקובץ שורה כל – (JSON Lines) JSONL בפורמט משתמשת הספרייה

מאפשר: זה פורמט עצמאי. JSON

.(append­only) יעילה בצורה חדשות רשומות הוספת -

סטנדרטיים. כלים באמצעות וניתוח קריאה -

אמת. בזמן לוגים של סטרימינג -

הלוגר מחלקת 10.6.2

JsonLogger מחלקת

class JsonLogger:

def __init__(self, component: str, league_id: str | None = None):

self.component = component

# Determine log directory

if league_id:

subdir = LOG_ROOT / "league" / league_id

else:

subdir = LOG_ROOT / "system"

subdir.mkdir(parents=True, exist_ok=True)

self.log_file = subdir / f"{component}.log.jsonl"

def log(self, event_type: str, level: str = "INFO", **details):

entry = {

"timestamp": datetime.utcnow().isoformat() + "Z",

"component": self.component,

"event_type": event_type,

"level": level,

**details,

}

with self.log_file.open("a", encoding="utf­8") as f:

f.write(json.dumps(entry, ensure_ascii=False) + "\n")

© Dr. Segal Yoram - שמורות הזכויות כל 120



נוחות שיטות 10.6.3

נפוצים: ולאירועים שונות לוג לרמות שיטות מספק הלוגר

ללוגר נוחות שיטות

def debug(self, event_type: str, **details):

self.log(event_type, level="DEBUG", **details)

def info(self, event_type: str, **details):

self.log(event_type, level="INFO", **details)

def warning(self, event_type: str, **details):

self.log(event_type, level="WARNING", **details)

def error(self, event_type: str, **details):

self.log(event_type, level="ERROR", **details)

def log_message_sent(self, message_type: str, recipient: str, **details)

:

self.debug("MESSAGE_SENT", message_type=message_type,

recipient=recipient, **details)

121 © Dr. Segal Yoram - שמורות הזכויות כל



בסוכנים שימוש 10.7

ליגה מנהל דוגמה: 10.7.1

ליגה במנהל ConfigLoader-ב שימוש

from league_sdk import ConfigLoader, JsonLogger

class LeagueManager:

def __init__(self, league_id: str):

loader = ConfigLoader()

self.system_cfg = loader.load_system()

self.agents_cfg = loader.load_agents()

self.league_cfg = loader.load_league(league_id)

self.logger = JsonLogger("league_manager", league_id)

# Build lookup maps

self.referees_by_id = {

r.referee_id: r.endpoint

for r in self.agents_cfg.referees if r.active

}

def get_timeout_for_move(self) ­> int:

return self.system_cfg.timeouts.move_timeout_sec

© Dr. Segal Yoram - שמורות הזכויות כל 122



שופט סוכן דוגמה: 10.7.2

בשופט ConfigLoader-ב שימוש

from league_sdk import ConfigLoader, JsonLogger

class RefereeAgent:

def __init__(self, referee_id: str, league_id: str):

loader = ConfigLoader()

self.system_cfg = loader.load_system()

self.league_cfg = loader.load_league(league_id)

self.self_cfg = loader.get_referee_by_id(referee_id)

self.logger = JsonLogger(f"referee:{referee_id}", league_id)

def register_to_league(self):

payload = {

"jsonrpc": "2.0",

"method": "register_referee",

"params": {

"protocol": self.system_cfg.protocol_version,

"message_type": "REFEREE_REGISTER_REQUEST",

"referee_meta": {

"display_name": self.self_cfg.display_name,

"version": self.self_cfg.version,

"game_types": self.self_cfg.game_types,

}

}

}

# ... send request

123 © Dr. Segal Yoram - שמורות הזכויות כל



שגיאה רישום דוגמה: 10.7.3

TIMEOUT שגיאת רישום

logger = JsonLogger("referee:REF01", "league_2025_even_odd")

logger.error(

"GAME_ERROR",

match_id="R1M1",

error_code="TIMEOUT_MOVE",

player_id="P02",

timeout_sec=30,

)

# Output to logs/league/league_2025_even_odd/referee_REF01.log.jsonl:

# {"timestamp":"2025­01­15T10:15:00Z","component":"referee:REF01",

# "event_type":"GAME_ERROR","level":"ERROR","match_id":"R1M1",...}

סיכום 10.8

הסוכנים: לקוד JSON-ה קובצי בין נקייה הפשטה שכבת מספקת league_sdk ספריית

נתונים. מבנה לכל (type­safe) בטוחים טיפוסים מגדיר – config_models.py -

מטמון. עם לקונפיגורציה נוחה גישה מספק – config_loader.py -

.Repository בדפוס ריצה נתוני מנהל – repositories.py -

.JSONL בפורמט מובנה לוגים רישום מאפשר – logger.py -

מבטיח: זו בספרייה שימוש

ונתונים. מודלים באותם משתמשים הסוכנים כל – עקביות .1

אחד. במקום מתרכזים הנתונים במבנה שינויים – תחזוקתיות .2

הקוד. כתיבת בזמן נתפסות שגיאות – טיפוסים בטיחות .3

בעיות. אחר קל מעקב מאפשרים מובנים לוגים – ניפוי יכולת .4

בתיקייה: זמינה הספרייה

L07/SHARED/league_sdk/

© Dr. Segal Yoram - שמורות הזכויות כל 124



הפרויקט מבנה 11

הדרכים מפת מבוא: 11.1

Python-ה וספריית הנתונים, ארכיטקטורת ,JSON-ה הודעות הפרוטוקול, את שהכרנו לאחר

והקבצים התיקיות מבנה את מציג זה נספח המלאה. התמונה את לראות הזמן הגיע –

ומוכן. מסודר בסיס עם לעבוד להתחיל יוכל סטודנט שכל כך הליגה, לפרויקט המומלץ

הראשי התיקיות עץ 11.2

L07/

SHARED/ agents/ doc/

הפרויקט של הבסיס תיקיות :21 טבלה

תיקייה תיאור

לוגים, נתונים, קונפיגורציה, – משותפים משאבים
SHARED/

SDK וספריית

agents/ נפרדת בתיקייה סוכן כל – הסוכנים קוד

doc/ ומפרטים מסמכים – הפרויקט תיעוד

SHARED/ – המשותפים המשאבים תיקיית 11.3

במערכת. הסוכנים לכל המשותפים המשאבים כל את מכילה זו תיקייה

SHARED/

├── config/ # Configuration layer

│ ├── system.json # Global system settings

│ ├── agents/

│ │ └── agents_config.json # All agents registry

│ ├── leagues/

│ │ └── league_2025_even_odd.json

│ ├── games/

│ │ └── games_registry.json # Supported game types

│ └── defaults/

│ ├── referee.json # Default referee settings

521 © Dr. Segal Yoram - שמורות הזכויות כל



│ └── player.json # Default player settings

│

├── data/ # Runtime data layer

│ ├── leagues/

│ │ └── league_2025_even_odd/

│ │ ├── standings.json # Current standings

│ │ └── rounds.json # Round history

│ ├── matches/

│ │ └── league_2025_even_odd/

│ │ ├── R1M1.json # Match R1M1 data

│ │ └── R1M2.json # Match R1M2 data

│ └── players/

│ ├── P01/

│ │ └── history.json # P01 match history

│ └── P02/

│ └── history.json # P02 match history

│

├── logs/ # Logging layer

│ ├── league/

│ │ └── league_2025_even_odd/

│ │ └── league.log.jsonl

│ ├── agents/

│ │ ├── REF01.log.jsonl

│ │ ├── P01.log.jsonl

│ │ └── P02.log.jsonl

│ └── system/

│ └── orchestrator.log.jsonl

│

└── league_sdk/ # Python SDK

├── __init__.py

├── config_models.py # Dataclass definitions

├── config_loader.py # ConfigLoader class

├── repositories.py # Data repositories

└── logger.py # JsonLogger class

© Dr. Segal Yoram - שמורות הזכויות כל 126



agents/ – הסוכנים תיקיית 11.4

אחיד: מבנה עם נפרדת בתיקייה חי סוכן כל

agents/

├── league_manager/

│ ├── main.py # Entry point

│ ├── handlers.py # Message handlers

│ ├── scheduler.py # Round scheduling

│ └── requirements.txt

│

├── referee_REF01/

│ ├── main.py # Entry point

│ ├── game_logic.py # Even/Odd rules

│ ├── handlers.py # Message handlers

│ └── requirements.txt

│

├── player_P01/

│ ├── main.py # Entry point

│ ├── strategy.py # Playing strategy

│ ├── handlers.py # Message handlers

│ └── requirements.txt

│

└── player_P02/

├── main.py

├── strategy.py

├── handlers.py

└── requirements.txt

טיפוסי סוכן מבנה 11.4.1

הבאים: הקבצים את מכיל סוכן כל

doc/ – התיעוד תיקיית 11.5

doc/

├── protocol­spec.md # Protocol specification

├── message­examples/ # JSON message examples

│ ├── registration/

│ │ ├── referee_register_request.json

│ │ └── player_register_request.json

721 © Dr. Segal Yoram - שמורות הזכויות כל



טיפוסי סוכן קבצי :22 טבלה

קובץ תפקיד

וטעינת השרת אתחול – כניסה נקודת
main.py

קונפיגורציה

handlers.py סוג לפי נכנסות בהודעות טיפול

strategy.py (לשחקנים) החלטות קבלת לוגיקת

game_logic.py (לשופטים) המשחק חוקי

requirements.txt Python תלויות

│ ├── game­flow/

│ │ ├── game_start.json

│ │ ├── move_request.json

│ │ └── game_over.json

│ └── errors/

│ ├── timeout_error.json

│ └── invalid_move.json

└── diagrams/

├── architecture.png

└── message­flow.png

© Dr. Segal Yoram - שמורות הזכויות כל 821



ארכיטקטורה דיאגרמת 11.6

League

Manager

קונפיג קריאת

Referee Player PlayerJSON­RPC תקשורת

REF01 P01 P02

config/ – קונפיגורציה

data/ – ריצה נתוני

logs/ – לוגים

league_sdk/ – Python ספריית

נתונים זרימת 11.7

וכתיבה קריאה 11.7.1

לקבצים גישה הרשאות :23 טבלה

קובץ/תיקייה קורא כותב הערות

בלבד קריאה
config/* כולם מערכת מנהל

לסוכנים

אחרי עדכון
standings.json כולם ליגה מנהל

משחק

היסטוריית
rounds.json כולם ליגה מנהל

מחזורים

matches/*.json כולם שופט למשחק קובץ

history.json השחקן השחקן אישית היסטוריה

logs/* DevOps סוכן כל בלבד משלו לוג

129 © Dr. Segal Yoram - שמורות הזכויות כל



והפעלה התקנה 11.8

מקדימות דרישות 11.8.1

Python 3.10+ -

חבילות לניהול poetry או pip -

SHARED/ לתיקיית גישה -

תלויות התקנת 11.8.2

# Install league_sdk

cd SHARED

pip install ­e league_sdk/

# Install agent dependencies

cd ../agents/player_P01

pip install ­r requirements.txt

סוכן הפעלת 11.8.3

# Start League Manager

cd agents/league_manager

python main.py ­­league­id league_2025_even_odd

# Start Referee

cd agents/referee_REF01

python main.py ­­referee­id REF01 \

­­league­id league_2025_even_odd

# Start Player

cd agents/player_P01

python main.py ­­player­id P01 \

­­league­id league_2025_even_odd

מלאה קבצים רשימת 11.9

בפרויקט: הקבצים כל של מלאה רשימה להלן

L07/

├── SHARED/

© Dr. Segal Yoram - שמורות הזכויות כל 031



│ ├── config/

│ │ ├── system.json

│ │ ├── agents/agents_config.json

│ │ ├── leagues/league_2025_even_odd.json

│ │ ├── games/games_registry.json

│ │ └── defaults/{referee,player}.json

│ ├── data/

│ │ ├── leagues/<league_id>/{standings,rounds}.json

│ │ ├── matches/<league_id>/<match_id>.json

│ │ └── players/<player_id>/history.json

│ ├── logs/

│ │ ├── league/<league_id>/*.log.jsonl

│ │ ├── agents/*.log.jsonl

│ │ └── system/*.log.jsonl

│ └── league_sdk/

│ ├── __init__.py

│ ├── config_models.py

│ ├── config_loader.py

│ ├── repositories.py

│ └── logger.py

├── agents/

│ ├── league_manager/{main,handlers,scheduler}.py

│ ├── referee_REF01/{main,handlers,game_logic}.py

│ └── player_*/{main,handlers,strategy}.py

└── doc/

├── protocol­spec.md

└── message­examples/**/*.json

סיכום 11.10

מספק: זה בנספח המוצג הפרויקט מבנה

משלו. בתיקייה רכיב כל – ברורה הפרדה .1

הנתונים. כל את מרכז SHARED/ – משותפים משאבים .2

עצמאי. באופן לפעול יכול סוכן כל – סוכנים עצמאות .3

.doc/-ב ומפרטים דוגמאות – מובנה תיעוד .4

חדשות. וליגות סוכנים להוסיף קל – הרחבה יכולת .5

בתיקייה: זמינים המלאים הקבצים

L07/SHARED/

131 © Dr. Segal Yoram - שמורות הזכויות כל



שלכם! הסוכנים את לבנות ולהתחיל המבנה את לשכפל מומלץ

© Dr. Segal Yoram - שמורות הזכויות כל 132



מקורות 12
1 Y. Segal, AI Agents with MCP. Dr. Yoram Segal, 2025, Hebrew edition.

2 Anthropic, Model context protocol specification, 2024. [Online]. Available: https://

modelcontextprotocol.io/

3 JSON­RPC Working Group, Json­rpc 2.0 specification, 2010. [Online]. Available:

https://www.jsonrpc.org/specification

4 K. Stratis, AI Agents with MCP. O’Reilly Media, 2025, Early Release.

133 © Dr. Segal Yoram - שמורות הזכויות כל